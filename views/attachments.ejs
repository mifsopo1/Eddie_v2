<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attachments - Discord Logger</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('partials/navbar') %>
    
    <div class="container">
        <div class="page-header">
            <h1>📎 Attachments Log</h1>
            <p class="page-subtitle">Browse and manage all uploaded files</p>
        </div>
        
        <% if (stats) { %>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">📎</div>
                    <div class="stat-info">
                        <div class="stat-value"><%= stats.totalAttachments.toLocaleString() %></div>
                        <div class="stat-label">Total Attachments</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">💾</div>
                    <div class="stat-info">
                        <div class="stat-value"><%= (stats.totalSize / 1024 / 1024).toFixed(2) %> MB</div>
                        <div class="stat-label">Total Size</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🖼️</div>
                    <div class="stat-info">
                        <div class="stat-value"><%= stats.imageCount.toLocaleString() %></div>
                        <div class="stat-label">Images</div>
                    </div>
                </div>
            </div>
        <% } %>
        
        <div class="filter-controls">
            <div class="filter-box">
                <label>Filter by type:</label>
                <select onchange="window.location='?type=' + this.value + '&page=1'">
                    <option value="all" <%= fileType === 'all' ? 'selected' : '' %>>All Files</option>
                    <option value="image" <%= fileType === 'image' ? 'selected' : '' %>>🖼️ Images</option>
                    <option value="video" <%= fileType === 'video' ? 'selected' : '' %>>🎬 Videos</option>
                    <option value="audio" <%= fileType === 'audio' ? 'selected' : '' %>>🎵 Audio</option>
                    <option value="other" <%= fileType === 'other' ? 'selected' : '' %>>📄 Other</option>
                </select>
            </div>
            <p class="result-count"><%= attachments.length %> attachments found</p>
        </div>
        
        <div class="attachments-grid">
            <% attachments.forEach(att => { %>
                <div class="attachment-card">
                    <div class="attachment-card-header">
                        <span class="file-type-badge <%= att.contentType && att.contentType.startsWith('image/') ? 'image' : att.contentType && att.contentType.startsWith('video/') ? 'video' : att.contentType && att.contentType.startsWith('audio/') ? 'audio' : 'file' %>">
                            <% if (att.contentType && att.contentType.startsWith('image/')) { %>
                                🖼️ IMAGE
                            <% } else if (att.contentType && att.contentType.startsWith('video/')) { %>
                                🎬 VIDEO
                            <% } else if (att.contentType && att.contentType.startsWith('audio/')) { %>
                                🎵 AUDIO
                            <% } else { %>
                                📄 FILE
                            <% } %>
                        </span>
                    </div>
                    
                    <% if (att.contentType && att.contentType.startsWith('image/')) { %>
                        <div class="attachment-card-preview">
                            <a href="<%= att.url %>" target="_blank">
                                <img src="<%= att.proxyUrl || att.url %>" 
                                     alt="<%= att.filename %>" 
                                     loading="lazy">
                            </a>
                        </div>
                    <% } else { %>
                        <div class="attachment-card-placeholder">
                            <div class="placeholder-icon">
                                <% if (att.contentType && att.contentType.startsWith('video/')) { %>
                                    🎬
                                <% } else if (att.contentType && att.contentType.startsWith('audio/')) { %>
                                    🎵
                                <% } else { %>
                                    📄
                                <% } %>
                            </div>
                            <p class="placeholder-text"><%= att.filename %></p>
                        </div>
                    <% } %>
                    
                    <div class="attachment-card-content">
                        <div class="attachment-filename" title="<%= att.filename %>">
                            <%= att.filename.length > 30 ? att.filename.substring(0, 30) + '...' : att.filename %>
                        </div>
                        
                        <div class="attachment-user-info">
                            <img src="https://cdn.discordapp.com/avatars/<%= att.userId %>/<%= att.userAvatar || '0' %>.png" 
                                 class="user-avatar-tiny" 
                                 onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
                            <a href="/user/<%= att.userId %>" class="user-link"><%= att.userName %></a>
                        </div>
                        
                        <div class="attachment-metadata">
                            <span class="meta-item">📝 #<%= att.channelName %></span>
                            <span class="meta-item">💾 <%= (att.size / 1024).toFixed(2) %> KB</span>
                            <% if (att.width && att.height) { %>
                                <span class="meta-item">📐 <%= att.width %>×<%= att.height %></span>
                            <% } %>
                            <span class="meta-item">🕒 <%= new Date(att.timestamp).toLocaleDateString() %></span>
                        </div>
                        
                        <div class="attachment-actions">
                            <a href="<%= att.url %>" target="_blank" class="btn-small btn-primary">
                                📥 Download
                            </a>
                            <a href="<%= att.url %>" target="_blank" class="btn-small btn-secondary">
                                🔗 View
                            </a>
                        </div>
                    </div>
                </div>
            <% }); %>
        </div>
        
        <% if (attachments.length === 0) { %>
            <div class="empty-state">
                <div class="empty-icon">📎</div>
                <h2>No attachments found</h2>
                <p>Try changing the filter or check back later</p>
            </div>
        <% } %>
        
        <% if (totalPages > 1) { %>
            <div class="pagination">
                <% if (currentPage > 1) { %>
                    <a href="?type=<%= fileType %>&page=<%= currentPage - 1 %>" class="btn">← Previous</a>
                <% } %>
                <span class="pagination-info">Page <%= currentPage %> of <%= totalPages %></span>
                <% if (currentPage < totalPages) { %>
                    <a href="?type=<%= fileType %>&page=<%= currentPage + 1 %>" class="btn">Next →</a>
                <% } %>
            </div>
        <% } %>
    </div>
</body>
</html>