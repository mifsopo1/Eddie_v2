<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Commands - Discord Logger</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('partials/navbar') %>
    
    <div class="commands-page">
        <!-- Modern Header -->
        <div class="commands-page-header">
            <h1>Custom Commands</h1>
            <button class="btn-primary-modern" onclick="showCreateForm()">
                Create New Command
            </button>
        </div>

        <!-- Success/Error Messages -->
        <% if (typeof success !== 'undefined' && success) { %>
            <div class="message-modern success"><%= success %></div>
        <% } %>
        <% if (typeof error !== 'undefined' && error) { %>
            <div class="message-modern error"><%= error %></div>
        <% } %>

        <!-- Quick Execute Section -->
        <div class="modern-section">
            <h2 class="modern-section-title">‚ö° Quick Execute</h2>
            <form action="/commands/execute" method="POST" class="quick-execute-modern">
                <div class="modern-form-group">
                    <label class="modern-form-label">Channel</label>
                    <select name="channelId" class="modern-select" required>
                        <option value="">Select Channel...</option>
                        <% channels.forEach(channel => { %>
                            <option value="<%= channel.id %>">#<%= channel.name %></option>
                        <% }); %>
                    </select>
                </div>
                <div class="modern-form-group">
                    <label class="modern-form-label">Command</label>
                    <input type="text" name="command" class="modern-input" placeholder="Enter command..." required>
                </div>
                <button type="submit" class="btn-primary-modern" style="margin-top: 22px;">Execute</button>
            </form>
        </div>

        <!-- Commands List Section -->
        <div class="modern-section">
            <h2 class="modern-section-title">üìã Command List</h2>
            
            <!-- Category Tabs -->
            <div class="modern-tabs">
                <button class="modern-tab active" data-category="all">All</button>
                <button class="modern-tab" data-category="general">General</button>
                <button class="modern-tab" data-category="fun">Fun</button>
                <button class="modern-tab" data-category="moderation">Moderation</button>
                <button class="modern-tab" data-category="info">Info</button>
                <button class="modern-tab" data-category="utility">Utility</button>
                <button class="modern-tab" data-category="custom">Custom</button>
            </div>

            <!-- Commands Grid -->
            <div id="commandsList">
                <% if (commands && commands.length > 0) { %>
                    <% commands.forEach(command => { %>
                        <div class="command-card-modern <%= command.enabled ? '' : 'disabled' %>" data-category="<%= command.category || 'custom' %>">
                            <div class="command-card-header-modern">
                                <div class="command-title-area">
                                    <h3 class="command-name-modern">
                                        <%= command.name || command.trigger %>
                                        <span class="command-badge-modern <%= command.category || 'custom' %>">
                                            <%= command.category || 'custom' %>
                                        </span>
                                        <span class="status-badge-modern <%= command.enabled ? 'enabled' : 'disabled' %>">
                                            <%= command.enabled ? 'enabled' : 'disabled' %>
                                        </span>
                                    </h3>
                                    <% if (command.description) { %>
                                        <p class="command-description-modern"><%= command.description %></p>
                                    <% } %>
                                </div>
                                <div class="command-actions-modern">
                                    <form action="/commands/toggle/<%= command._id %>" method="POST" style="display: inline;">
                                        <button type="submit" class="btn-icon-modern" title="Toggle">
                                            <%= command.enabled ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è' %>
                                        </button>
                                    </form>
                                    <button class="btn-icon-modern edit" onclick="editCommand('<%= command._id %>')" title="Edit">
                                        ‚úèÔ∏è
                                    </button>
                                    <form action="/commands/delete/<%= command._id %>" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this command?');">
                                        <button type="submit" class="btn-icon-modern delete" title="Delete">
                                            üóëÔ∏è
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <div class="command-meta-modern">
                                <div class="meta-item-modern">
                                    <strong>Trigger:</strong> <%= command.trigger %>
                                </div>
                                <div class="meta-item-modern">
                                    <strong>Type:</strong> <%= command.triggerType || 'command' %>
                                </div>
                                <div class="meta-item-modern">
                                    <strong>Response:</strong> <%= command.responseType || 'text' %>
                                </div>
                                <div class="meta-item-modern">
                                    <strong>Uses:</strong> <%= command.uses || 0 %>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="empty-state-modern">
                        <div class="empty-state-icon-modern">üì¶</div>
                        <div class="empty-state-text-modern">No commands yet</div>
                        <div class="empty-state-subtext-modern">Create your first custom command to get started</div>
                    </div>
                <% } %>
            </div>
        </div>

        <!-- Create Command Form (Hidden by default) -->
        <div id="createCommandForm" class="modern-section" style="display: none;">
            <h2 class="modern-section-title">‚ûï Create New Command</h2>
            
            <form action="/commands/create" method="POST" class="command-form-modern">
                <div class="form-grid-modern">
                    <!-- Basic Settings -->
                    <div class="form-section-modern">
                        <h3>Basic Settings</h3>
                        
                        <div class="modern-form-group">
                            <label class="modern-form-label">Command Name</label>
                            <input type="text" name="name" class="modern-input" placeholder="e.g., Welcome Message" required>
                        </div>

                        <div class="modern-form-group">
                            <label class="modern-form-label">Trigger</label>
                            <input type="text" name="trigger" class="modern-input" placeholder="e.g., welcome" required>
                            <small>The word or phrase that triggers this command</small>
                        </div>

                        <div class="modern-form-group">
                            <label class="modern-form-label">Trigger Type</label>
                            <select name="triggerType" class="modern-select" required>
                                <option value="command">Command (!trigger)</option>
                                <option value="exact">Exact Match</option>
                                <option value="contains">Contains Text</option>
                                <option value="startswith">Starts With</option>
                                <option value="regex">Regular Expression</option>
                            </select>
                        </div>

                        <div class="modern-form-group">
                            <label class="modern-form-label">Category</label>
                            <select name="category" class="modern-select">
                                <option value="custom">Custom</option>
                                <option value="general">General</option>
                                <option value="fun">Fun</option>
                                <option value="moderation">Moderation</option>
                                <option value="info">Info</option>
                                <option value="utility">Utility</option>
                            </select>
                        </div>

                        <div class="modern-form-group">
                            <label class="modern-form-label">Description</label>
                            <textarea name="description" class="modern-textarea" placeholder="What does this command do?"></textarea>
                        </div>
                    </div>

                    <!-- Response Settings -->
                    <div class="form-section-modern">
                        <h3>Response Settings</h3>
                        
                        <div class="modern-form-group">
                            <label class="modern-form-label">Response Type</label>
                            <select name="responseType" class="modern-select" required>
                                <option value="text">Text</option>
                                <option value="embed">Embed</option>
                                <option value="dm">DM</option>
                                <option value="react">Reaction</option>
                                <option value="multiple">Multiple</option>
                            </select>
                        </div>

                        <div class="modern-form-group">
                            <label class="modern-form-label">Response Content</label>
                            <textarea name="response" class="modern-textarea" rows="6" placeholder="Your response message..." required></textarea>
                            <small>Available variables: <code>{user}</code>, <code>{user.mention}</code>, <code>{channel}</code>, <code>{server}</code>, <code>{membercount}</code></small>
                        </div>

                        <div class="modern-form-group">
                            <label class="modern-form-label">Cooldown (seconds)</label>
                            <input type="number" name="userCooldown" class="modern-input" placeholder="0" min="0">
                            <small>Time users must wait between uses</small>
                        </div>

                        <div class="modern-form-group">
                            <label class="modern-form-label">Usage Limit</label>
                            <input type="number" name="usageLimit" class="modern-input" placeholder="0 = unlimited" min="0">
                            <small>Total times this command can be used (0 for unlimited)</small>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions-modern">
                    <button type="submit" class="btn-primary-modern btn-large-modern">Create Command</button>
                    <button type="button" class="btn-secondary-modern btn-large-modern"