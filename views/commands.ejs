<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Commands - Discord Logger</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
    <div class="nav-brand">
        <h2>ü§ñ <%= client.user.tag %></h2>
    </div>
    <div class="nav-links">
        <a href="/">Dashboard</a>
        <a href="/messages">Messages</a>
        <a href="/deleted">Deleted</a>
        <a href="/members">Members</a>
        <a href="/moderation">Moderation</a>
        <a href="/attachments">Attachments</a>
        <a href="/voice">Voice</a>
        <a href="/invites">Invites</a>
        <a href="/commands">Commands</a>
        <a href="/analytics">Analytics</a>
        <a href="/logout" class="logout">Logout</a>
    </div>
</nav>
    
    <div class="container-fluid">
        <div class="commands-header">
            <h1>‚öôÔ∏è Custom Commands</h1>
            <button class="btn btn-primary" onclick="toggleCreateForm()">
                ‚ûï Create New Command
            </button>
        </div>
        
        <% if (success && success.length > 0) { %>
            <div class="success-message"><%= success %></div>
        <% } %>
        <% if (error && error.length > 0) { %>
            <div class="error-message"><%= error %></div>
        <% } %>
        
        <!-- Command Executor (Collapsible) -->
        <div class="command-section collapsible">
            <div class="section-header" onclick="toggleSection(this)">
                <h2>üí¨ Execute Command</h2>
                <span class="toggle-icon">‚ñº</span>
            </div>
            <div class="section-content">
                <form id="executeForm" onsubmit="executeCommand(event)" class="executor-form">
                    <select id="channelSelect" required>
                        <option value="">Select Channel...</option>
                    </select>
                    <input type="text" id="commandInput" placeholder="Enter command or message" required>
                    <button type="submit" class="btn btn-primary">Send</button>
                </form>
                <div id="executeResult"></div>
            </div>
        </div>
        
        <!-- Create New Command (Collapsible, Hidden by Default) -->
        <div class="command-section collapsible collapsed" id="createCommandSection">
            <div class="section-header" onclick="toggleSection(this)">
                <h2>‚ûï Create Custom Command</h2>
                <span class="toggle-icon">‚ñ∂</span>
            </div>
            <div class="section-content" style="display: none;">
                <form method="POST" action="/commands/create" id="commandForm">
                    
                    <!-- Two Column Layout -->
                    <div class="form-grid">
                        
                        <!-- Left Column -->
                        <div class="form-column">
                            
                            <!-- Basic Settings -->
                            <div class="form-card">
                                <h3>üìã Basic Settings</h3>
                                
                                <div class="form-group">
                                    <label>Command Name *</label>
                                    <input type="text" name="name" placeholder="My Command" required>
                                </div>
                                
                                <div class="form-group-row">
                                    <div class="form-group">
                                        <label>Category</label>
                                        <select name="category">
                                            <option value="general">General</option>
                                            <option value="fun">Fun</option>
                                            <option value="moderation">Moderation</option>
                                            <option value="info">Information</option>
                                            <option value="utility">Utility</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>Status</label>
                                        <label class="switch">
                                            <input type="checkbox" name="enabled" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Description</label>
                                    <input type="text" name="description" placeholder="What does this command do?">
                                </div>
                            </div>
                            
                            <!-- Trigger Settings -->
                            <div class="form-card">
                                <h3>üéØ Trigger Settings</h3>
                                
                                <div class="form-group">
                                    <label>Trigger Type</label>
                                    <select name="triggerType" id="triggerType" onchange="updateTriggerHelp()">
                                        <option value="command">Command (!trigger)</option>
                                        <option value="exact">Exact Match</option>
                                        <option value="contains">Contains Word</option>
                                        <option value="startswith">Starts With</option>
                                        <option value="regex">Regular Expression</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Trigger(s) *</label>
                                    <input type="text" name="trigger" id="triggerInput" placeholder="hello, hi, hey" required>
                                    <small id="triggerHelp">Separate multiple triggers with commas</small>
                                </div>
                                
                                <div class="form-group-row">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="caseSensitive">
                                        <span>Case Sensitive</span>
                                    </label>
                                    
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="deleteTrigger">
                                        <span>Delete Trigger Message</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Response Settings -->
                            <div class="form-card">
                                <h3>üí¨ Response</h3>
                                
                                <div class="form-group">
                                    <label>Response Type</label>
                                    <select name="responseType" id="responseType" onchange="updateResponseType()">
                                        <option value="text">Text Message</option>
                                        <option value="embed">Embed</option>
                                        <option value="dm">Direct Message</option>
                                        <option value="react">Add Reaction</option>
                                        <option value="multiple">Text + Reaction</option>
                                    </select>
                                </div>
                                
                                <!-- Text Response -->
                                <div id="textResponse" class="response-type-content">
                                    <div class="form-group">
                                        <label>Message *</label>
                                        <textarea name="response" rows="5" placeholder="Hello {user.mention}! Welcome to {server}!"></textarea>
                                        <div class="variables-help">
                                            <strong>Variables:</strong>
                                            <code>{user}</code> <code>{user.mention}</code> <code>{user.id}</code>
                                            <code>{channel}</code> <code>{channel.mention}</code> <code>{server}</code>
                                            <code>{membercount}</code> <code>{args}</code> <code>{args.0}</code>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Embed Response -->
                                <div id="embedResponse" class="response-type-content" style="display: none;">
                                    <div class="form-group">
                                        <label>Title</label>
                                        <input type="text" name="embedTitle" placeholder="Embed Title">
                                    </div>
                                    <div class="form-group">
                                        <label>Description</label>
                                        <textarea name="embedDescription" rows="4" placeholder="Embed description"></textarea>
                                    </div>
                                    <div class="form-group-row">
                                        <div class="form-group">
                                            <label>Color (hex)</label>
                                            <input type="color" name="embedColor" value="#5865f2">
                                        </div>
                                        <div class="form-group">
                                            <label>Footer</label>
                                            <input type="text" name="embedFooter" placeholder="Footer text">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Image URL</label>
                                        <input type="text" name="embedImage" placeholder="https://example.com/image.png">
                                    </div>
                                    <div class="form-group">
                                        <label>Thumbnail URL</label>
                                        <input type="text" name="embedThumbnail" placeholder="https://example.com/thumb.png">
                                    </div>
                                </div>
                                
                                <!-- Reaction Response -->
                                <div id="reactionResponse" class="response-type-content" style="display: none;">
                                    <div class="form-group">
                                        <label>Emoji</label>
                                        <input type="text" name="reactionEmoji" placeholder="‚úÖ or :emoji_name:">
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        
                        <!-- Right Column -->
                        <div class="form-column">
                            
                            <!-- Channel Restrictions -->
                            <div class="form-card">
                                <h3>üîí Channel Restrictions</h3>
                                
                                <div class="form-group">
                                    <label>Allowed Channels</label>
                                    <div class="channel-selector">
                                        <div class="channel-search">
                                            <input type="text" id="allowedChannelsSearch" placeholder="Search channels..." onkeyup="filterChannels('allowedChannels')">
                                        </div>
                                        <div class="channel-list" id="allowedChannelsList">
                                            <label class="channel-item">
                                                <input type="checkbox" name="allowedChannels" value="all" checked onchange="handleAllChannels('allowedChannels')">
                                                <span>All Channels</span>
                                            </label>
                                            <!-- Channels loaded via JS -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Ignored Channels</label>
                                    <div class="channel-selector">
                                        <div class="channel-search">
                                            <input type="text" id="ignoredChannelsSearch" placeholder="Search channels..." onkeyup="filterChannels('ignoredChannels')">
                                        </div>
                                        <div class="channel-list" id="ignoredChannelsList">
                                            <!-- Channels loaded via JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Role Restrictions -->
                            <div class="form-card">
                                <h3>üë• Role Restrictions</h3>
                                
                                <div class="form-group">
                                    <label>Required Roles</label>
                                    <div class="channel-selector">
                                        <div class="channel-search">
                                            <input type="text" id="requiredRolesSearch" placeholder="Search roles..." onkeyup="filterChannels('requiredRoles')">
                                        </div>
                                        <div class="channel-list" id="requiredRolesList">
                                            <label class="channel-item">
                                                <input type="checkbox" name="requiredRoles" value="everyone" checked onchange="handleEveryoneRole('requiredRoles')">
                                                <span>@everyone</span>
                                            </label>
                                            <!-- Roles loaded via JS -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Ignored Roles</label>
                                    <div class="channel-selector">
                                        <div class="channel-search">
                                            <input type="text" id="ignoredRolesSearch" placeholder="Search roles..." onkeyup="filterChannels('ignoredRoles')">
                                        </div>
                                        <div class="channel-list" id="ignoredRolesList">
                                            <!-- Roles loaded via JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Cooldowns -->
                            <div class="form-card">
                                <h3>‚è±Ô∏è Cooldowns</h3>
                                
                                <div class="form-group-row">
                                    <div class="form-group">
                                        <label>User (seconds)</label>
                                        <input type="number" name="userCooldown" value="0" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label>Channel (seconds)</label>
                                        <input type="number" name="channelCooldown" value="0" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label>Server (seconds)</label>
                                        <input type="number" name="serverCooldown" value="0" min="0">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Advanced Options -->
                            <div class="form-card">
                                <h3>‚öôÔ∏è Advanced</h3>
                                
                                <div class="form-group">
                                    <label>Usage Limit (0 = unlimited)</label>
                                    <input type="number" name="usageLimit" value="0" min="0">
                                </div>
                                
                                <div class="form-group-row">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="dmResponse">
                                        <span>Send as DM</span>
                                    </label>
                                    
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="deleteAfter">
                                        <span>Auto-delete after</span>
                                    </label>
                                    
                                    <input type="number" name="deleteAfterSeconds" value="10" min="1" max="60" style="width: 80px;">
                                    <span>sec</span>
                                </div>
                            </div>
                            
                        </div>
                        
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large">
                            ‚úÖ Create Command
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="toggleCreateForm()">
                            ‚ùå Cancel
                        </button>
                    </div>
                    
                </form>
            </div>
        </div>
        
        <!-- Existing Commands -->
        <div class="command-section">
            <div class="section-header">
                <h2>üìã Custom Commands (<%= commands.length %>)</h2>
                <div class="command-filters">
                    <button class="filter-btn active" onclick="filterCommands('all')">All</button>
                    <button class="filter-btn" onclick="filterCommands('general')">General</button>
                    <button class="filter-btn" onclick="filterCommands('fun')">Fun</button>
                    <button class="filter-btn" onclick="filterCommands('moderation')">Moderation</button>
                    <button class="filter-btn" onclick="filterCommands('info')">Info</button>
                    <button class="filter-btn" onclick="filterCommands('utility')">Utility</button>
                    <button class="filter-btn" onclick="filterCommands('custom')">Custom</button>
                </div>
            </div>
            
            <div class="section-content">
                <% if (commands.length === 0) { %>
                    <div class="empty-state">
                        <p>No custom commands yet. Create your first one above!</p>
                    </div>
                <% } else { %>
                    <div class="commands-table">
                        <% commands.forEach(cmd => { %>
                            <div class="command-row <%= cmd.enabled ? 'enabled' : 'disabled' %>" data-category="<%= cmd.category || 'general' %>">
                                <div class="command-main">
                                    <div class="command-info">
                                        <div class="command-name-row">
                                            <h3><%= cmd.name || cmd.trigger %></h3>
                                            <span class="command-badge <%= cmd.category || 'general' %>">
                                                <%= (cmd.category || 'general').toUpperCase() %>
                                            </span>
                                            <span class="command-status <%= cmd.enabled ? 'enabled' : 'disabled' %>">
                                                <%= cmd.enabled ? '‚úÖ Enabled' : '‚ùå Disabled' %>
                                            </span>
                                        </div>
                                        
                                        <% if (cmd.description) { %>
                                            <p class="command-desc"><%= cmd.description %></p>
                                        <% } %>
                                        
                                        <div class="command-details">
                                            <span class="detail-item">
                                                <strong>Trigger:</strong> 
                                                <% if (cmd.triggerType === 'command') { %>
                                                    !<%= Array.isArray(cmd.trigger) ? cmd.trigger.join(', !') : cmd.trigger %>
                                                <% } else { %>
                                                    <%= cmd.triggerType %> - "<%= Array.isArray(cmd.trigger) ? cmd.trigger.join(', ') : cmd.trigger %>"
                                                <% } %>
                                            </span>
                                            
                                            <span class="detail-item">
                                                <strong>Type:</strong> <%= cmd.responseType || 'text' %>
                                            </span>
                                            
                                            <span class="detail-item">
                                                <strong>Uses:</strong> <%= cmd.uses || 0 %>
                                            </span>
                                            
                                            <% if (cmd.userCooldown > 0 || cmd.channelCooldown > 0 || cmd.serverCooldown > 0) { %>
                                                <span class="detail-item">
                                                    <strong>Cooldown:</strong> 
                                                    <% if (cmd.userCooldown > 0) { %><%= cmd.userCooldown %>s/user<% } %>
                                                    <% if (cmd.channelCooldown > 0) { %><%= cmd.channelCooldown %>s/ch<% } %>
                                                    <% if (cmd.serverCooldown > 0) { %><%= cmd.serverCooldown %>s/srv<% } %>
                                                </span>
                                            <% } %>
                                        </div>
                                    </div>
                                    
                                    <div class="command-actions-row">
                                        <button 
                                            class="btn-icon toggle" 
                                            onclick="toggleCommand('<%= cmd._id %>')"
                                            title="<%= cmd.enabled ? 'Disable' : 'Enable' %>"
                                        >
                                            <%= cmd.enabled ? 'üëÅÔ∏è' : 'üö´' %>
                                        </button>
                                        <form method="POST" action="/commands/delete/<%= cmd._id %>" style="display: inline;">
                                            <button type="submit" class="btn-icon delete" onclick="return confirm('Delete this command?')" title="Delete">                                                üóëÔ∏è
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } %>
            </div>
        </div>
        
    </div>
    
    <script src="/js/commands.js"></script>
</body>
</html>