<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commands Manager - Discord Logger</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        /* Inline Navbar Styles */
        .navbar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.75rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .nav-brand { display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0; }
        .bot-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid rgba(88, 101, 242, 0.5); box-shadow: 0 0 12px rgba(88, 101, 242, 0.3); }
        .bot-info { display: flex; flex-direction: column; gap: 0.15rem; }
        .bot-info h2 { color: #fff; font-size: 1.1rem; margin: 0; font-weight: 600; line-height: 1; }
        .bot-status { color: #43b581; font-size: 0.7rem; font-weight: 500; line-height: 1; }
        .nav-center { flex: 1; display: flex; justify-content: center; overflow-x: auto; }
        .nav-links { display: flex; gap: 0.35rem; flex-wrap: nowrap; justify-content: center; }
        .nav-links a { color: var(--text-secondary); text-decoration: none; padding: 0.5rem 0.85rem; border-radius: 6px; transition: all 0.2s ease; font-weight: 500; font-size: 0.85rem; display: flex; align-items: center; gap: 0.4rem; white-space: nowrap; }
        .nav-icon { font-size: 0.95rem; }
        .nav-links a:hover { background: rgba(255, 255, 255, 0.1); color: #fff; transform: translateY(-1px); }
        .nav-links a.active { background: rgba(88, 101, 242, 0.25); color: var(--primary); box-shadow: 0 2px 8px rgba(88, 101, 242, 0.3); }
        .nav-user { display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0; }
        .user-profile { display: flex; align-items: center; gap: 0.6rem; background: rgba(0, 0, 0, 0.3); padding: 0.4rem 0.8rem; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
        .user-profile:hover { background: rgba(0, 0, 0, 0.4); border-color: rgba(88, 101, 242, 0.5); }
        .user-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.2); }
        .user-avatar-placeholder { width: 32px; height: 32px; border-radius: 50%; background: rgba(88, 101, 242, 0.3); display: flex; align-items: center; justify-content: center; font-size: 1.3rem; border: 2px solid rgba(255, 255, 255, 0.2); }
        .user-details { display: flex; flex-direction: column; gap: 0.15rem; }
        .user-name { color: #fff; font-weight: 600; font-size: 0.85rem; line-height: 1; }
        .user-badge { font-size: 0.65rem; font-weight: 700; padding: 0.1rem 0.4rem; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.3px; width: fit-content; line-height: 1; }
        .user-badge.admin { background: rgba(88, 101, 242, 0.3); color: #5865f2; }
        .user-badge.password { background: rgba(250, 166, 26, 0.3); color: #faa61a; }
        .logout-btn { background: rgba(237, 66, 69, 0.2); color: var(--danger); padding: 0.5rem; border-radius: 6px; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; text-decoration: none; border: 1px solid rgba(237, 66, 69, 0.3); width: 36px; height: 36px; }
        .logout-btn:hover { background: rgba(237, 66, 69, 0.3); transform: scale(1.08); }

        /* Enhanced Multi-Select Roles */
        .role-selector { position: relative; width: 100%; }
        .role-tags { min-height: 60px; padding: 0.75rem; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; display: flex; flex-wrap: wrap; gap: 0.5rem; cursor: pointer; transition: all 0.2s ease; }
        .role-tags:hover { border-color: rgba(88,101,242,0.5); }
        .role-tag { background: rgba(88,101,242,0.3); color: #5865f2; padding: 0.4rem 0.8rem; border-radius: 6px; display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; }
        .role-tag-remove { cursor: pointer; font-weight: bold; opacity: 0.7; transition: opacity 0.2s; }
        .role-tag-remove:hover { opacity: 1; }
        .role-dropdown { position: absolute; top: 100%; left: 0; right: 0; max-height: 200px; overflow-y: auto; background: rgba(20,23,28,0.98); border: 1px solid rgba(88,101,242,0.5); border-radius: 8px; margin-top: 0.5rem; display: none; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.5); }
        .role-dropdown.active { display: block; }
        .role-option { padding: 0.75rem; cursor: pointer; transition: background 0.2s; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .role-option:hover { background: rgba(88,101,242,0.2); }

        /* Tab Navigation */
        .tab-navigation { display: flex; gap: 0.5rem; margin-bottom: 2rem; border-bottom: 2px solid rgba(255,255,255,0.1); overflow-x: auto; }
        .tab-nav-btn { background: transparent; border: none; color: rgba(255,255,255,0.6); padding: 1rem 1.5rem; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s ease; font-weight: 600; white-space: nowrap; }
        .tab-nav-btn:hover { color: #fff; border-bottom-color: rgba(88,101,242,0.5); }
        .tab-nav-btn.active { color: #5865f2; border-bottom-color: #5865f2; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Copyable Content */
        .copy-btn { position: absolute; top: 1rem; right: 1rem; background: rgba(88,101,242,0.2); color: #5865f2; border: 1px solid rgba(88,101,242,0.3); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; font-weight: 600; font-size: 0.85rem; }
        .copy-btn:hover { background: rgba(88,101,242,0.3); transform: translateY(-1px); }
        .copyable-content { background: rgba(0,0,0,0.4); padding: 1rem; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1); margin-top: 1rem; font-family: 'Courier New', monospace; color: rgba(255,255,255,0.9); position: relative; }

        /* Sections */
        .sticky-section { background: linear-gradient(135deg, rgba(30,33,40,0.95) 0%, rgba(20,23,28,0.95) 100%); border: 1px solid rgba(250,166,26,0.3); border-radius: 12px; padding: 2rem; margin: 2rem 0; }
        .sticky-card { background: rgba(0,0,0,0.3); border: 1px solid rgba(250,166,26,0.3); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; position: relative; }
        .sticky-indicator { display: inline-block; background: rgba(250,166,26,0.2); color: #faa61a; padding: 0.3rem 0.8rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600; }

        .ruleset-section { background: linear-gradient(135deg, rgba(30,33,40,0.95) 0%, rgba(20,23,28,0.95) 100%); border: 1px solid rgba(237,66,69,0.3); border-radius: 12px; padding: 2rem; margin: 2rem 0; }
        .ruleset-card { background: rgba(0,0,0,0.3); border: 1px solid rgba(237,66,69,0.3); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; position: relative; }
        .rule-list { list-style: none; padding: 0; margin: 1rem 0; }
        .rule-item { padding: 0.75rem; background: rgba(0,0,0,0.2); border-left: 3px solid #ed4245; margin-bottom: 0.5rem; border-radius: 4px; }

        .bulk-actions { background: rgba(88,101,242,0.1); border: 1px solid rgba(88,101,242,0.3); border-radius: 12px; padding: 1.5rem; margin: 2rem 0; }
        .channel-response-section { background: rgba(67,181,129,0.1); border: 1px solid rgba(67,181,129,0.3); border-radius: 8px; padding: 1.5rem; margin-top: 1rem; }
        .response-channel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem; }

        /* Command Cards */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem; }
        .command-card { background: linear-gradient(135deg, rgba(30,33,40,0.95) 0%, rgba(20,23,28,0.95) 100%); border: 1px solid rgba(88,101,242,0.3); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; transition: all 0.3s ease; position: relative; }
        .command-card:hover { border-color: rgba(88,101,242,0.6); box-shadow: 0 4px 20px rgba(88,101,242,0.25); transform: translateY(-2px); }
        .command-card.disabled { opacity: 0.5; }
        .command-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .command-actions { display: flex; gap: 0.5rem; }
        .command-meta { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px; }

        .badge-general { background: rgba(88,101,242,0.2); color: #5865f2; }
        .badge-fun { background: rgba(250,166,26,0.2); color: #faa61a; }
        .badge-moderation { background: rgba(237,66,69,0.2); color: #ed4245; }
        .badge-info { background: rgba(67,181,129,0.2); color: #43b581; }
        .role-badge { background: rgba(237,66,69,0.2); color: #ed4245; padding: 0.25rem 0.6rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; display: inline-flex; align-items: center; gap: 0.25rem; }
        .role-badge.exempt { background: rgba(67,181,129,0.2); color: #43b581; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(4px); }
        .modal-content { background: linear-gradient(135deg, rgba(30,33,40,0.98) 0%, rgba(20,23,28,0.98) 100%); margin: 3% auto; padding: 2rem; border: 1px solid rgba(88,101,242,0.3); border-radius: 12px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 1.5rem; margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .close { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 1; }
        .close:hover { color: #fff; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }

        @media (max-width: 1400px) {
            .nav-links a span:not(.nav-icon) { display: none; }
            .nav-links a { padding: 0.5rem 0.6rem; }
        }
        @media (max-width: 1024px) {
            .navbar { flex-wrap: wrap; padding: 0.75rem 1rem; }
            .nav-center { order: 3; width: 100%; margin-top: 0.75rem; justify-content: flex-start; }
            .nav-links { justify-content: flex-start; }
            .bot-status { display: none; }
        }
        @media (max-width: 768px) {
            .navbar { padding: 0.6rem 0.8rem; }
            .bot-avatar { width: 36px; height: 36px; }
            .bot-info h2 { font-size: 1rem; }
            .user-details { display: none; }
            .user-avatar, .user-avatar-placeholder { width: 36px; height: 36px; }
            .nav-center { overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
            .nav-center::-webkit-scrollbar { display: none; }
            .nav-links { gap: 0.25rem; }
            .nav-links a { padding: 0.45rem 0.55rem; font-size: 0.8rem; }
            .form-grid, .form-row { grid-template-columns: 1fr; }
            .response-channel-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
   <!-- Paste this AFTER <body> tag in EACH file -->
<style>
    /* Navbar Styles */
    .navbar {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 0.75rem 1.5rem;
        position: sticky;
        top: 0;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    
    .nav-brand { 
        display: flex; 
        align-items: center; 
        gap: 0.75rem; 
        flex-shrink: 0;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .nav-brand:hover {
        transform: translateY(-1px);
    }
    
    .bot-avatar { width: 40px; height: 40px; border-radius: 50%; border: 2px solid rgba(88, 101, 242, 0.5); box-shadow: 0 0 12px rgba(88, 101, 242, 0.3); }
    .bot-info { display: flex; flex-direction: column; gap: 0.15rem; }
    .bot-info h2 { 
        color: #fff; 
        font-size: 1.1rem; 
        margin: 0; 
        font-weight: 600; 
        line-height: 1;
        transition: color 0.2s ease;
    }
    
    .nav-brand:hover .bot-info h2 {
        color: #5865f2;
    }
    
    .bot-status { color: #43b581; font-size: 0.7rem; font-weight: 500; line-height: 1; }
    .nav-center { flex: 1; display: flex; justify-content: center; overflow-x: auto; }
    .nav-links { display: flex; gap: 0.35rem; flex-wrap: nowrap; justify-content: center; }
    .nav-links a { color: var(--text-secondary); text-decoration: none; padding: 0.5rem 0.85rem; border-radius: 6px; transition: all 0.2s ease; font-weight: 500; font-size: 0.85rem; display: flex; align-items: center; gap: 0.4rem; white-space: nowrap; }
    .nav-icon { font-size: 0.95rem; }
    .nav-links a:hover { background: rgba(255, 255, 255, 0.1); color: #fff; transform: translateY(-1px); }
    .nav-links a.active { background: rgba(88, 101, 242, 0.25); color: var(--primary); box-shadow: 0 2px 8px rgba(88, 101, 242, 0.3); }
    .nav-user { display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0; }
    
    .user-profile { 
        display: flex; 
        align-items: center; 
        gap: 0.6rem; 
        background: rgba(0, 0, 0, 0.3); 
        padding: 0.4rem 0.8rem; 
        border-radius: 8px; 
        border: 1px solid rgba(255, 255, 255, 0.1); 
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .user-profile:hover { 
        background: rgba(0, 0, 0, 0.4); 
        border-color: rgba(88, 101, 242, 0.5);
        transform: translateY(-1px);
    }
    
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.2); }
    .user-avatar-placeholder { width: 32px; height: 32px; border-radius: 50%; background: rgba(88, 101, 242, 0.3); display: flex; align-items: center; justify-content: center; font-size: 1.3rem; border: 2px solid rgba(255, 255, 255, 0.2); }
    .user-details { display: flex; flex-direction: column; gap: 0.15rem; }
    .user-name { color: #fff; font-weight: 600; font-size: 0.85rem; line-height: 1; }
    .user-badge { font-size: 0.65rem; font-weight: 700; padding: 0.1rem 0.4rem; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.3px; width: fit-content; line-height: 1; }
    .user-badge.admin { background: rgba(88, 101, 242, 0.3); color: #5865f2; }
    .user-badge.password { background: rgba(250, 166, 26, 0.3); color: #faa61a; }
    .logout-btn { background: rgba(237, 66, 69, 0.2); color: var(--danger); padding: 0.5rem; border-radius: 6px; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; text-decoration: none; border: 1px solid rgba(237, 66, 69, 0.3); width: 36px; height: 36px; }
    .logout-btn:hover { background: rgba(237, 66, 69, 0.3); transform: scale(1.08); }

    /* Modal Styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        z-index: 2000;
        align-items: center;
        justify-content: center;
    }
    
    .modal.active {
        display: flex;
    }
    
    .modal-content {
        background: linear-gradient(135deg, rgba(30, 33, 40, 0.98) 0%, rgba(20, 23, 28, 0.98) 100%);
        border: 1px solid rgba(88, 101, 242, 0.4);
        border-radius: 12px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        animation: modalSlideIn 0.3s ease;
    }
    
    @keyframes modalSlideIn {
        from { transform: translateY(-20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .modal-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 3px solid rgba(88, 101, 242, 0.5);
        box-shadow: 0 0 16px rgba(88, 101, 242, 0.3);
    }
    
    .modal-title {
        flex: 1;
    }
    
    .modal-title h2 {
        color: #fff;
        font-size: 1.3rem;
        margin: 0 0 0.25rem 0;
    }
    
    .modal-title p {
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.85rem;
        margin: 0;
    }
    
    .modal-close {
        background: rgba(237, 66, 69, 0.2);
        border: 1px solid rgba(237, 66, 69, 0.3);
        color: #ed4245;
        width: 32px;
        height: 32px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        transition: all 0.2s ease;
    }
    
    .modal-close:hover {
        background: rgba(237, 66, 69, 0.3);
        transform: scale(1.1);
    }
    
    .info-field {
        margin-bottom: 1.25rem;
    }
    
    .info-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
    }
    
    .info-value-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        padding: 0.75rem;
    }
    
    .info-value {
        flex: 1;
        color: #fff;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        word-break: break-all;
    }
    
    .copy-btn {
        background: rgba(88, 101, 242, 0.2);
        border: 1px solid rgba(88, 101, 242, 0.3);
        color: #5865f2;
        padding: 0.4rem 0.75rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.75rem;
        font-weight: 600;
        transition: all 0.2s ease;
        white-space: nowrap;
    }
    
    .copy-btn:hover {
        background: rgba(88, 101, 242, 0.3);
        transform: scale(1.05);
    }
    
    .copy-btn.copied {
        background: rgba(67, 181, 129, 0.2);
        border-color: rgba(67, 181, 129, 0.3);
        color: #43b581;
    }

    @media (max-width: 1400px) {
        .nav-links a span:not(.nav-icon) { display: none; }
        .nav-links a { padding: 0.5rem 0.6rem; }
    }
    
    @media (max-width: 1024px) {
        .navbar { flex-wrap: wrap; padding: 0.75rem 1rem; }
        .nav-center { order: 3; width: 100%; margin-top: 0.75rem; justify-content: flex-start; }
        .nav-links { justify-content: flex-start; }
        .bot-status { display: none; }
    }
    
    @media (max-width: 768px) {
        .navbar { padding: 0.6rem 0.8rem; }
        .bot-avatar { width: 36px; height: 36px; }
        .bot-info h2 { font-size: 1rem; }
        .user-details { display: none; }
        .user-avatar, .user-avatar-placeholder { width: 36px; height: 36px; }
        .nav-center { overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .nav-center::-webkit-scrollbar { display: none; }
        .nav-links { gap: 0.25rem; }
        .nav-links a { padding: 0.45rem 0.55rem; font-size: 0.8rem; }
        .modal-content { padding: 1.5rem; }
    }
</style>

<nav class="navbar">
    <div class="nav-brand" onclick="openBotModal()">
        <img src="<%= client.user.displayAvatarURL({ size: 64 }) %>" alt="Bot Avatar" class="bot-avatar">
        <div class="bot-info">
            <h2>Drug Dealer Simulator | Eddie</h2>
            <span class="bot-status">Online ‚Ä¢ Monitoring</span>
        </div>
    </div>
    
    <div class="nav-center">
        <div class="nav-links">
            <a href="/" class="<%= typeof page !== 'undefined' && page === 'dashboard' ? 'active' : '' %>">
                <span class="nav-icon">üìä</span> <span>Dashboard</span>
            </a>
            <a href="/messages" class="<%= typeof page !== 'undefined' && page === 'messages' ? 'active' : '' %>">
                <span class="nav-icon">üí¨</span> <span>Messages</span>
            </a>
            <a href="/deleted" class="<%= typeof page !== 'undefined' && page === 'deleted' ? 'active' : '' %>">
                <span class="nav-icon">üóëÔ∏è</span> <span>Deleted</span>
            </a>
            <a href="/members" class="<%= typeof page !== 'undefined' && page === 'members' ? 'active' : '' %>">
                <span class="nav-icon">üë•</span> <span>Members</span>
            </a>
            <a href="/moderation" class="<%= typeof page !== 'undefined' && page === 'moderation' ? 'active' : '' %>">
                <span class="nav-icon">üî®</span> <span>Moderation</span>
            </a>
            <a href="/attachments" class="<%= typeof page !== 'undefined' && page === 'attachments' ? 'active' : '' %>">
                <span class="nav-icon">üìé</span> <span>Attachments</span>
            </a>
            <a href="/voice" class="<%= typeof page !== 'undefined' && page === 'voice' ? 'active' : '' %>">
                <span class="nav-icon">üîä</span> <span>Voice</span>
            </a>
            <a href="/invites" class="<%= typeof page !== 'undefined' && page === 'invites' ? 'active' : '' %>">
                <span class="nav-icon">üé´</span> <span>Invites</span>
            </a>
            <a href="/commands" class="<%= typeof page !== 'undefined' && page === 'commands' ? 'active' : '' %>">
                <span class="nav-icon">‚öôÔ∏è</span> <span>Commands</span>
            </a>
            <a href="/analytics" class="<%= typeof page !== 'undefined' && page === 'analytics' ? 'active' : '' %>">
                <span class="nav-icon">üìà</span> <span>Analytics</span>
            </a>
            <a href="/appeals" class="<%= page === 'appeals' ? 'active' : '' %>">
                <span class="nav-icon">üé´</span> <span>Appeals</span>
            </a>
        </div>
    </div>

    <div class="nav-user">
        <% if (user) { %>
            <div class="user-profile" onclick="openUserModal()">
                <img src="<%= user.avatar %>" alt="<%= user.username %>" class="user-avatar">
                <div class="user-details">
                    <span class="user-name"><%= user.username %></span>
                    <span class="user-badge admin">Admin</span>
                </div>
            </div>
        <% } else { %>
            <div class="user-profile" onclick="openUserModal()">
                <div class="user-avatar-placeholder">üë§</div>
                <div class="user-details">
                    <span class="user-name">Admin</span>
                    <span class="user-badge password">Password Auth</span>
                </div>
            </div>
        <% } %>
        
        <a href="/logout" class="logout-btn" title="Logout">
            <span class="nav-icon">üö™</span>
        </a>
    </div>
</nav>

<!-- Bot Info Modal -->
<div id="botModal" class="modal" onclick="closeModal('botModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <img src="<%= client.user.displayAvatarURL({ size: 128 }) %>" alt="Bot Avatar" class="modal-avatar">
            <div class="modal-title">
                <h2><%= client.user.username %></h2>
                <p>Bot Information</p>
            </div>
            <button class="modal-close" onclick="closeModal('botModal')">√ó</button>
        </div>
        
        <div class="info-field">
            <div class="info-label">Bot ID</div>
            <div class="info-value-container">
                <div class="info-value" id="botId"><%= client.user.id %></div>
                <button class="copy-btn" onclick="copyToClipboard('botId', this)">Copy</button>
            </div>
        </div>
        
        <div class="info-field">
            <div class="info-label">Username</div>
            <div class="info-value-container">
                <div class="info-value" id="botUsername"><%= client.user.username %></div>
                <button class="copy-btn" onclick="copyToClipboard('botUsername', this)">Copy</button>
            </div>
        </div>
        
        <div class="info-field">
            <div class="info-label">Tag</div>
            <div class="info-value-container">
                <div class="info-value" id="botTag"><%= client.user.tag %></div>
                <button class="copy-btn" onclick="copyToClipboard('botTag', this)">Copy</button>
            </div>
        </div>
    </div>
</div>

<!-- User Info Modal -->
<div id="userModal" class="modal" onclick="closeModal('userModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <% if (user) { %>
                <img src="<%= user.avatar %>" alt="<%= user.username %>" class="modal-avatar">
            <% } else { %>
                <div class="modal-avatar" style="display: flex; align-items: center; justify-content: center; background: rgba(88, 101, 242, 0.3); font-size: 2rem;">üë§</div>
            <% } %>
            <div class="modal-title">
                <h2><%= user ? user.username : 'Admin' %></h2>
                <p>User Information</p>
            </div>
            <button class="modal-close" onclick="closeModal('userModal')">√ó</button>
        </div>
        
        <% if (user) { %>
            <div class="info-field">
                <div class="info-label">User ID</div>
                <div class="info-value-container">
                    <div class="info-value" id="userId"><%= user.id %></div>
                    <button class="copy-btn" onclick="copyToClipboard('userId', this)">Copy</button>
                </div>
            </div>
            
            <div class="info-field">
                <div class="info-label">Username</div>
                <div class="info-value-container">
                    <div class="info-value" id="username"><%= user.username %></div>
                    <button class="copy-btn" onclick="copyToClipboard('username', this)">Copy</button>
                </div>
            </div>
            
            <div class="info-field">
                <div class="info-label">Discriminator</div>
                <div class="info-value-container">
                    <div class="info-value" id="discriminator"><%= user.discriminator || '0' %></div>
                    <button class="copy-btn" onclick="copyToClipboard('discriminator', this)">Copy</button>
                </div>
            </div>
        <% } else { %>
            <div class="info-field">
                <div class="info-label">Authentication</div>
                <div class="info-value-container">
                    <div class="info-value">Password Authentication</div>
                </div>
            </div>
            <div class="info-field">
                <div class="info-label">Role</div>
                <div class="info-value-container">
                    <div class="info-value">Administrator</div>
                </div>
            </div>
        <% } %>
    </div>
</div>

<script>
    function openBotModal() {
        document.getElementById('botModal').classList.add('active');
    }

    function openUserModal() {
        document.getElementById('userModal').classList.add('active');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }

    function copyToClipboard(elementId, button) {
        const text = document.getElementById(elementId).textContent;
        navigator.clipboard.writeText(text).then(() => {
            const originalText = button.textContent;
            button.textContent = '‚úì Copied';
            button.classList.add('copied');
            
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
            }, 2000);
        });
    }

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
        }
    });
</script>

    <!-- Main Content -->
    <div class="container" style="margin-top: 2rem; max-width: 1400px; padding: 0 1.5rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div>
                <h1 style="color: #fff; margin-bottom: 0.5rem; font-size: 2rem;">üéÆ Commands Manager</h1>
                <p style="color: rgba(255,255,255,0.6); margin: 0;">Advanced command system with rulesets, sticky messages, and bulk actions</p>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-nav-btn active" onclick="window.commandsApp.switchMainTab('commands', event)">üí¨ Commands</button>
            <button class="tab-nav-btn" onclick="window.commandsApp.switchMainTab('sticky', event)">üìå Sticky Messages</button>
            <button class="tab-nav-btn" onclick="window.commandsApp.switchMainTab('rulesets', event)">üìã Rulesets</button>
            <button class="tab-nav-btn" onclick="window.commandsApp.switchMainTab('bulk', event)">üî® Bulk Actions</button>
            <button class="tab-nav-btn" onclick="window.commandsApp.switchMainTab('protection', event)">üõ°Ô∏è Protection</button>
        </div>
        
        <!-- Commands Tab -->
        <div id="tab-commands" class="tab-content active">
            <div style="display: flex; gap: 0.75rem; margin-bottom: 2rem; flex-wrap: wrap;">
                <button onclick="window.commandsApp.toggleCreateForm()" class="btn btn-primary">‚ûï Create Command</button>
                <a href="/commands/settings" class="btn btn-secondary" style="text-decoration: none;">‚öôÔ∏è Command Settings</a>
                <a href="/commands/all" class="btn btn-secondary" style="text-decoration: none;">üìã View All Commands</a>
            </div>

            <!-- Create Command Form -->
            <div id="createCommandSection" style="display: none; background: rgba(30,33,40,0.95); border: 1px solid rgba(88,101,242,0.3); border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
                <h2 style="color: #fff; margin-bottom: 1.5rem;">üìù Create New Command</h2>
                <form method="POST" action="/commands/create">
                    <div class="form-grid">
                        <div>
                            <div class="form-group">
                                <label>Command Name *</label>
                                <input type="text" name="name" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Category</label>
                                <select name="category">
                                    <option value="general">General</option>
                                    <option value="fun">Fun</option>
                                    <option value="moderation">Moderation</option>
                                    <option value="info">Info</option>
                                    <option value="utility">Utility</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Trigger Text *</label>
                                <input type="text" name="trigger" required>
                                <small>Separate multiple with commas</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Required Roles</label>
                                <div class="role-selector">
                                    <div class="role-tags" id="requiredRoleTags" onclick="window.commandsApp.toggleRoleDropdown('required')">
                                        <span style="color: rgba(255,255,255,0.5);">Click to select roles...</span>
                                    </div>
                                    <div class="role-dropdown" id="requiredRoleDropdown"></div>
                                    <input type="hidden" name="requiredRoles" id="requiredRolesInput">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Exempt Roles</label>
                                <div class="role-selector">
                                    <div class="role-tags" id="exemptRoleTags" onclick="window.commandsApp.toggleRoleDropdown('exempt')">
                                        <span style="color: rgba(255,255,255,0.5);">Click to select roles...</span>
                                    </div>
                                    <div class="role-dropdown" id="exemptRoleDropdown"></div>
                                    <input type="hidden" name="exemptRoles" id="exemptRolesInput">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="form-group">
                                <label>Response Type</label>
                                <select name="responseType">
                                    <option value="text">Text Message</option>
                                    <option value="embed">Embed</option>
                                    <option value="react">Reaction</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Response Content</label>
                                <textarea name="response" rows="8" placeholder="Your response message here..."></textarea>
                                <small>Variables: {user}, {server}, {channel}</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Description</label>
                                <textarea name="description" rows="2" placeholder="What does this command do?"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label><input type="checkbox" name="enabled" checked> Enabled</label>
                            </div>
                            
                            <div class="form-group">
                                <label><input type="checkbox" name="deleteTrigger"> Delete Trigger Message</label>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
                        <button type="button" onclick="window.commandsApp.toggleCreateForm()" class="btn btn-secondary">Cancel</button>
                        <button type="submit" class="btn btn-primary">üíæ Create Command</button>
                    </div>
                </form>
            </div>
            
            <!-- Command List -->
            <div class="section">
                <h2 class="section-title">üìã Command List</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="window.commandsApp.filterCommands('all', event)">All</button>
                    <button class="tab" onclick="window.commandsApp.filterCommands('general', event)">General</button>
                    <button class="tab" onclick="window.commandsApp.filterCommands('fun', event)">Fun</button>
                    <button class="tab" onclick="window.commandsApp.filterCommands('moderation', event)">Moderation</button>
                    <button class="tab" onclick="window.commandsApp.filterCommands('info', event)">Info</button>
                    <button class="tab" onclick="window.commandsApp.filterCommands('utility', event)">Utility</button>
                </div>

                <div class="commands-table">
                    <% if (commands && commands.length > 0) { %>
                        <% commands.forEach(cmd => { %>
                            <div class="command-card <%= cmd.enabled ? '' : 'disabled' %>" data-category="<%= cmd.category || 'general' %>">
                                <div class="command-header">
                                    <div>
                                        <h3><%= cmd.name %></h3>
                                        <div>
                                            <span class="badge badge-<%= cmd.category || 'general' %>"><%= cmd.category || 'general' %></span>
                                            <% if (cmd.type === 'builtin') { %>
                                                <span class="badge" style="background: rgba(88, 101, 242, 0.3); color: #5865f2;">Built-in</span>
                                            <% } %>
                                            <span class="badge <%= cmd.enabled ? 'badge-enabled' : 'badge-disabled' %>">
                                                <%= cmd.enabled ? 'Enabled' : 'Disabled' %>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="command-actions">
                                        <% if (cmd.type !== 'builtin') { %>
                                            <button class="btn-icon" onclick="window.commandsApp.editCommand('<%= cmd._id %>')" title="Edit">‚úèÔ∏è</button>
                                        <% } %>
                                        <button class="btn-icon toggle" onclick="window.commandsApp.toggleCommand('<%= cmd._id %>', '<%= cmd.type %>')" title="Toggle">
                                            <%= cmd.enabled ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è' %>
                                        </button>
                                        <% if (cmd.type !== 'builtin') { %>
                                            <button class="btn-icon delete" onclick="if(confirm('Delete this command?')) { window.location.href='/commands/delete/<%= cmd._id %>' }" title="Delete">üóëÔ∏è</button>
                                        <% } %>
                                    </div>
                                </div>
                                
                                <% if (cmd.description) { %>
                                    <p class="command-desc"><%= cmd.description %></p>
                                <% } %>
                                
                                <div class="command-meta">
                                    <div class="meta-item">
                                        <strong>Trigger</strong>
                                        <span><%= cmd.triggerType === 'command' ? '!' : '' %><%= Array.isArray(cmd.trigger) ? cmd.trigger.join(', ') : cmd.trigger %></span>
                                    </div>
                                    <div class="meta-item">
                                        <strong>Type</strong>
                                        <span><%= cmd.responseType %></span>
                                    </div>
                                    <div class="meta-item">
                                        <strong>Uses</strong>
                                        <span><%= cmd.uses || 0 %></span>
                                    </div>
                                </div>

                                <% if ((cmd.requiredRoles && cmd.requiredRoles.length > 0) || (cmd.exemptRoles && cmd.exemptRoles.length > 0)) { %>
                                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                                        <% if (cmd.requiredRoles && cmd.requiredRoles.length > 0) { %>
                                            <div style="margin-bottom: 0.5rem;">
                                                <strong style="color: rgba(255,255,255,0.6); font-size: 0.75rem;">Required Roles:</strong>
                                                <div style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin-top: 0.25rem;">
                                                    <% cmd.requiredRoles.forEach(roleId => { %>
                                                        <span class="role-badge" data-role-id="<%= roleId %>">üîí <%= roleId %></span>
                                                    <% }) %>
                                                </div>
                                            </div>
                                        <% } %>
                                        <% if (cmd.exemptRoles && cmd.exemptRoles.length > 0) { %>
                                            <div>
                                                <strong style="color: rgba(255,255,255,0.6); font-size: 0.75rem;">Exempt Roles:</strong>
                                                <div style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin-top: 0.25rem;">
                                                    <% cmd.exemptRoles.forEach(roleId => { %>
                                                        <span class="role-badge exempt" data-role-id="<%= roleId %>">‚úÖ <%= roleId %></span>
                                                    <% }) %>
                                                </div>
                                            </div>
                                        <% } %>
                                    </div>
                                <% } %>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <div class="empty-state">
                            <div class="empty-state-icon">üì¶</div>
                            <div class="empty-state-text">No commands yet</div>
                            <div class="empty-state-subtext">Create your first custom command to get started</div>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Sticky Messages Tab -->
        <div id="tab-sticky" class="tab-content">
            <div class="sticky-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h2 style="color: #fff; margin: 0;">üìå Sticky Messages</h2>
                        <p style="color: rgba(255,255,255,0.6); margin: 0.5rem 0 0 0;">Pin important messages that auto-repost when pushed up</p>
                    </div>
                    <button onclick="window.commandsApp.openStickyModal()" class="btn btn-primary">‚ûï Create Sticky</button>
                </div>

                <div id="stickyMessagesList">
                    <div style="text-align: center; padding: 3rem;">
                        <div style="font-size: 1.2rem; color: rgba(255,255,255,0.5);">Loading sticky messages...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rulesets Tab -->
        <!-- Rulesets Tab -->
<div id="tab-rulesets" class="tab-content">
    <div class="ruleset-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div>
                <h2 style="color: #fff; margin: 0;">üõ°Ô∏è AutoMod Rulesets</h2>
                <p style="color: rgba(255,255,255,0.6); margin: 0.5rem 0 0 0;">Automatic moderation rules based on message content and user behavior</p>
            </div>
            <button onclick="window.commandsApp.openRulesetModal()" class="btn btn-primary">‚ûï Create Ruleset</button>
        </div>

        <!-- Dynamic rulesets container -->
        <div id="rulesetsListContainer">
            <div style="text-align: center; padding: 3rem;">
                <div style="font-size: 1.2rem; color: rgba(255,255,255,0.5);">Loading rulesets...</div>
            </div>
        </div>
    </div>
</div>

        <!-- Bulk Actions Tab -->
        <div id="tab-bulk" class="tab-content">
            <div class="bulk-actions">
                <h2 style="color: #fff; margin-bottom: 1rem;">üî® Bulk Command Actions</h2>
                <p style="color: rgba(255,255,255,0.6); margin-bottom: 2rem;">Perform actions on multiple commands at once</p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #fff; margin-bottom: 1rem;">üîÄ Enable/Disable All</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-success" onclick="window.commandsApp.bulkToggleCommands(true)">Enable All</button>
                            <button class="btn btn-secondary" onclick="window.commandsApp.bulkToggleCommands(false)">Disable All</button>
                        </div>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #fff; margin-bottom: 1rem;">üìä Category Actions</h3>
                        <select id="bulkCategory" class="form-control" style="margin-bottom: 0.5rem;">
                            <option value="">Select Category</option>
                            <option value="general">General</option>
                            <option value="fun">Fun</option>
                            <option value="moderation">Moderation</option>
                            <option value="info">Info</option>
                        </select>
                        <button class="btn btn-primary" onclick="window.commandsApp.bulkCategoryAction()">Apply to Category</button>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #fff; margin-bottom: 1rem;">üóëÔ∏è Cleanup</h3>
                        <button class="btn btn-danger" onclick="if(confirm('Delete all disabled commands?')) window.commandsApp.bulkDelete()">Delete Disabled Commands</button>
                    </div>
                </div>

                <div class="channel-response-section" style="margin-top: 2rem;">
                    <h3 style="color: #fff; margin-bottom: 1rem;">üìç Channel-Specific Responses</h3>
                    <p style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">Set different responses for commands in specific channels</p>
                    
                    <div class="response-channel-grid">
                        <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                            <strong style="color: #fff; display: block; margin-bottom: 0.5rem;">#general</strong>
                            <span style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">3 custom responses</span>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                            <strong style="color: #fff; display: block; margin-bottom: 0.5rem;">#announcements</strong>
                            <span style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">1 custom response</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Protection Tab -->
        <div id="tab-protection" class="tab-content">
            <div style="background: linear-gradient(135deg, rgba(30,33,40,0.95) 0%, rgba(20,23,28,0.95) 100%); border: 1px solid rgba(67,181,129,0.3); border-radius: 12px; padding: 2rem;">
                <h2 style="color: #fff; margin-bottom: 1rem;">üõ°Ô∏è Command Protection</h2>
                <p style="color: rgba(255,255,255,0.6); margin-bottom: 2rem;">Configure rate limiting and abuse prevention</p>

                <div style="display: grid; gap: 1.5rem;">
                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #fff; margin-bottom: 1rem;">‚è±Ô∏è Rate Limiting</h3>
                        <div class="form-group">
                            <label>Commands per minute (per user)</label>
                            <input type="number" value="5" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Cooldown between uses (seconds)</label>
                            <input type="number" value="3" class="form-control">
                        </div>
                        <button class="btn btn-primary">üíæ Save Settings</button>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #fff; margin-bottom: 1rem;">üö´ Spam Prevention</h3>
                        <label style="color: rgba(255,255,255,0.8); display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                            <input type="checkbox" checked> Detect command spam
                        </label>
                        <label style="color: rgba(255,255,255,0.8); display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                            <input type="checkbox" checked> Auto-timeout spammers
                        </label>
                        <label style="color: rgba(255,255,255,0.8); display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox"> Log abuse attempts
                        </label>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                        <h3 style="color: #fff; margin-bottom: 1rem;">üìä Usage Statistics</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; color: #5865f2; font-weight: bold;">1,247</div>
                                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Total Uses</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; color: #43b581; font-weight: bold;">23</div>
                                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Active Commands</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; color: #ed4245; font-weight: bold;">8</div>
                                <div style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Blocked Attempts</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sticky Message Modal -->
    <div id="stickyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: #fff; margin: 0;">üìå Create Sticky Message</h2>
                <span class="close" onclick="window.commandsApp.closeStickyModal()">&times;</span>
            </div>
            <form id="stickyMessageForm">
                <div class="form-group">
                    <label>Channel *</label>
                    <select name="channelId" id="stickyChannelId" required>
                        <option value="">Select Channel...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Message *</label>
                    <textarea name="message" id="stickyMessage" rows="6" required placeholder="This message will stay at the bottom of the channel..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Repost Threshold</label>
                    <input type="number" name="threshold" id="stickyThreshold" value="10" min="1" max="50">
                    <small>Repost after this many messages</small>
                </div>
                
                <div class="form-group">
                    <label><input type="checkbox" name="enabled" id="stickyEnabled" checked> Enable immediately</label>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button type="button" onclick="window.commandsApp.closeStickyModal()" class="btn btn-secondary">Cancel</button>
                    <button type="button" onclick="window.commandsApp.submitStickyForm()" class="btn btn-primary">üíæ Create Sticky</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Sticky Message Modal -->
    <div id="editStickyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: #fff; margin: 0;">‚úèÔ∏è Edit Sticky Message</h2>
                <span class="close" onclick="window.commandsApp.closeEditStickyModal()">&times;</span>
            </div>
            <form id="editStickyMessageForm">
                <input type="hidden" id="editStickyId" name="stickyId">
                
                <div class="form-group">
                    <label>Channel *</label>
                    <select name="channelId" id="editStickyChannelId" required>
                        <option value="">Select Channel...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Message *</label>
                    <textarea name="message" id="editStickyMessage" rows="6" required placeholder="This message will stay at the bottom of the channel..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Repost Threshold</label>
                    <input type="number" name="threshold" id="editStickyThreshold" value="10" min="1" max="50">
                    <small>Repost after this many messages</small>
                </div>
                
                <div class="form-group">
                    <label><input type="checkbox" name="enabled" id="editStickyEnabled"> Enable</label>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button type="button" onclick="window.commandsApp.closeEditStickyModal()" class="btn btn-secondary">Cancel</button>
                    <button type="button" onclick="window.commandsApp.submitEditStickyForm()" class="btn btn-primary">üíæ Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ruleset Modal -->
    <div id="rulesetModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 style="color: #fff; margin: 0;">üõ°Ô∏è Create AutoMod Ruleset</h2>
                <span class="close" onclick="window.commandsApp.closeRulesetModal()">&times;</span>
            </div>
            <form onsubmit="window.commandsApp.saveRuleset(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ruleset Name *</label>
                        <input type="text" name="name" required placeholder="Anti-Spam">
                    </div>
                    <div class="form-group">
                        <label>Priority</label>
                        <select name="priority">
                            <option value="high">üî¥ High</option>
                            <option value="medium" selected>üü° Medium</option>
                            <option value="low">üü¢ Low</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="2" placeholder="What does this ruleset do?"></textarea>
                </div>
                
                <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 1.5rem 0; padding-top: 1.5rem;">
                    <h3 style="color: #fff; margin-bottom: 1rem;">üéØ Trigger Conditions</h3>
                    
                    <div class="form-group">
                        <label>Trigger Type *</label>
                        <select name="triggerType" id="rulesetTriggerType" onchange="window.commandsApp.updateRulesetTriggerFields()" required>
                            <option value="">Select trigger type...</option>
                            <option value="spam">üí¨ Spam Detection (rapid messages)</option>
                            <option value="links">üîó Link Filter (URLs & invites)</option>
                            <option value="words">üö´ Banned Words</option>
                            <option value="mentions">üë• Excessive Mentions</option>
                            <option value="caps">üî† Caps Lock Abuse</option>
                            <option value="attachments">üìé Attachment Limits</option>
                        </select>
                    </div>
                    
                    <div id="triggerConfigFields" style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                        <p style="color: rgba(255,255,255,0.6);">Select a trigger type to configure</p>
                    </div>
                </div>
                
                <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 1.5rem 0; padding-top: 1.5rem;">
                    <h3 style="color: #fff; margin-bottom: 1rem;">‚ö° Actions</h3>
                    
                    <div class="form-group">
                        <label>Action Type *</label>
                        <select name="actionType" id="rulesetActionType" onchange="window.commandsApp.updateRulesetActionFields()" required>
                            <option value="">Select action...</option>
                            <option value="delete">üóëÔ∏è Delete Message</option>
                            <option value="warn">‚ö†Ô∏è Warn User</option>
                            <option value="timeout">‚è∞ Timeout User</option>
                            <option value="kick">üë¢ Kick User</option>
                            <option value="ban">üî® Ban User</option>
                        </select>
                    </div>
                    
                    <div id="actionConfigFields" style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                        <p style="color: rgba(255,255,255,0.6);">Select an action type to configure</p>
                    </div>
                </div>
                
                <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 1.5rem 0; padding-top: 1.5rem;">
                    <h3 style="color: #fff; margin-bottom: 1rem;">üõ°Ô∏è Exclusions</h3>
                    
                    <div class="form-group">
                        <label>Excluded Roles (comma-separated IDs)</label>
                        <input type="text" name="excludedRoles" placeholder="123456789, 987654321">
                        <small>Users with these roles will be exempt</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Excluded Channels (comma-separated IDs)</label>
                        <input type="text" name="excludedChannels" placeholder="123456789, 987654321">
                        <small>Rule won't apply in these channels</small>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button type="button" onclick="window.commandsApp.closeRulesetModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">üíæ Create Ruleset</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Edit Ruleset Modal -->
<div id="editRulesetModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2 style="color: #fff; margin: 0;">‚úèÔ∏è Edit AutoMod Ruleset</h2>
            <span class="close" onclick="window.commandsApp.closeEditRulesetModal()">&times;</span>
        </div>
        <form id="editRulesetForm" onsubmit="window.commandsApp.updateRuleset(event)">
            <input type="hidden" id="editRulesetId" name="rulesetId">
            
            <div class="form-row">
                <div class="form-group">
                    <label>Ruleset Name *</label>
                    <input type="text" name="name" id="editRulesetName" required placeholder="Anti-Spam">
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select name="priority" id="editRulesetPriority">
                        <option value="high">üî¥ High</option>
                        <option value="medium">üü° Medium</option>
                        <option value="low">üü¢ Low</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Description</label>
                <textarea name="description" id="editRulesetDescription" rows="2" placeholder="What does this ruleset do?"></textarea>
            </div>
            
            <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 1.5rem 0; padding-top: 1.5rem;">
                <h3 style="color: #fff; margin-bottom: 1rem;">üéØ Trigger Conditions</h3>
                
                <div class="form-group">
                    <label>Trigger Type *</label>
                    <select name="triggerType" id="editRulesetTriggerType" onchange="window.commandsApp.updateEditRulesetTriggerFields()" required>
                        <option value="">Select trigger type...</option>
                        <option value="spam">üí¨ Spam Detection (rapid messages)</option>
                        <option value="links">üîó Link Filter (URLs & invites)</option>
                        <option value="words">üö´ Banned Words</option>
                        <option value="mentions">üë• Excessive Mentions</option>
                        <option value="caps">üî† Caps Lock Abuse</option>
                        <option value="attachments">üìé Attachment Limits</option>
                    </select>
                </div>
                
                <div id="editTriggerConfigFields" style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                    <p style="color: rgba(255,255,255,0.6);">Select a trigger type to configure</p>
                </div>
            </div>
            
            <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 1.5rem 0; padding-top: 1.5rem;">
                <h3 style="color: #fff; margin-bottom: 1rem;">‚ö° Actions</h3>
                
                <div class="form-group">
                    <label>Action Type *</label>
                    <select name="actionType" id="editRulesetActionType" onchange="window.commandsApp.updateEditRulesetActionFields()" required>
                        <option value="">Select action...</option>
                        <option value="delete">üóëÔ∏è Delete Message</option>
                        <option value="warn">‚ö†Ô∏è Warn User</option>
                        <option value="timeout">‚è∞ Timeout User</option>
                        <option value="kick">üë¢ Kick User</option>
                        <option value="ban">üî® Ban User</option>
                    </select>
                </div>
                
                <div id="editActionConfigFields" style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                    <p style="color: rgba(255,255,255,0.6);">Select an action type to configure</p>
                </div>
            </div>
            
            <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 1.5rem 0; padding-top: 1.5rem;">
                <h3 style="color: #fff; margin-bottom: 1rem;">üõ°Ô∏è Exclusions</h3>
                
                <div class="form-group">
                    <label>Excluded Roles (comma-separated IDs)</label>
                    <input type="text" name="excludedRoles" id="editExcludedRoles" placeholder="123456789, 987654321">
                    <small>Users with these roles will be exempt</small>
                </div>
                
                <div class="form-group">
                    <label>Excluded Channels (comma-separated IDs)</label>
                    <input type="text" name="excludedChannels" id="editExcludedChannels" placeholder="123456789, 987654321">
                    <small>Rule won't apply in these channels</small>
                </div>
                
                <div class="form-group">
                    <label>Whitelisted Domains (for link filters, comma-separated)</label>
                    <input type="text" name="whitelistedDomains" id="editWhitelistedDomains" placeholder="youtube.com, twitter.com">
                    <small>These domains will be allowed through link filters</small>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <button type="button" onclick="window.commandsApp.closeEditRulesetModal()" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
            </div>
        </form>
    </div>
</div>
    <!-- Edit Command Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: #fff; margin: 0;">‚úèÔ∏è Edit Command</h2>
                <span class="close" onclick="window.commandsApp.closeEditModal()">&times;</span>
            </div>
            <form method="POST" action="/commands/update" id="editCommandForm">
                <input type="hidden" name="commandId" id="editCommandId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Command Name</label>
                        <input type="text" name="name" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select name="category" id="editCategory">
                            <option value="general">General</option>
                            <option value="fun">Fun</option>
                            <option value="moderation">Moderation</option>
                            <option value="info">Info</option>
                            <option value="utility">Utility</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Trigger Text</label>
                    <input type="text" name="trigger" id="editTrigger" required>
                </div>

                <div class="form-group">
                    <label>Response Content</label>
                    <textarea name="response" id="editResponse" rows="6"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Response Type</label>
                        <select name="responseType" id="editResponseType">
                            <option value="text">Text Message</option>
                            <option value="embed">Embed</option>
                            <option value="react">Reaction</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="enabled" id="editEnabled"> Enabled
                        </label>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button type="button" onclick="window.commandsApp.closeEditModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    // ============================================
    // COMMANDS APP - INITIALIZE IMMEDIATELY
    // ============================================
    
    // Create global app object FIRST
    window.commandsApp = {
        rolesData: <%- JSON.stringify(roles || []) %>,
        selectedRequiredRoles: new Set(),
        selectedExemptRoles: new Set(),
        
        // Initialize app
        init: function() {
            console.log('‚úÖ Commands App initialized');
            this.initializeRoleDropdowns();
            this.loadRoleNames();
            this.setupEventListeners();
        },
        
        // Setup event listeners
        setupEventListeners: function() {
            // Close dropdowns when clicking outside
            document.addEventListener('click', (event) => {
                if (!event.target.closest('.role-selector')) {
                    document.querySelectorAll('.role-dropdown').forEach(dropdown => {
                        dropdown.classList.remove('active');
                    });
                }
            });
            
            // Close modals when clicking outside
            window.onclick = (event) => {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            };
        },
        
        // Role selector functions
        initializeRoleDropdowns: function() {
            const requiredDropdown = document.getElementById('requiredRoleDropdown');
            const exemptDropdown = document.getElementById('exemptRoleDropdown');
            
            if (requiredDropdown && exemptDropdown) {
                this.rolesData.forEach(role => {
                    const requiredOption = this.createRoleOption(role, 'required');
                    const exemptOption = this.createRoleOption(role, 'exempt');
                    requiredDropdown.appendChild(requiredOption);
                    exemptDropdown.appendChild(exemptOption);
                });
            }
        },
        
        createRoleOption: function(role, type) {
            const option = document.createElement('div');
            option.className = 'role-option';
            option.textContent = role.name;
            option.onclick = () => this.toggleRole(role.id, role.name, type);
            return option;
        },
        
        toggleRoleDropdown: function(type) {
            const dropdown = document.getElementById(`${type}RoleDropdown`);
            if (dropdown) {
                dropdown.classList.toggle('active');
                
                const otherType = type === 'required' ? 'exempt' : 'required';
                const otherDropdown = document.getElementById(`${otherType}RoleDropdown`);
                if (otherDropdown) {
                    otherDropdown.classList.remove('active');
                }
            }
        },
        
        toggleRole: function(roleId, roleName, type) {
            const selectedSet = type === 'required' ? this.selectedRequiredRoles : this.selectedExemptRoles;
            
            if (selectedSet.has(roleId)) {
                selectedSet.delete(roleId);
            } else {
                selectedSet.add(roleId);
            }
            
            this.updateRoleTags(type);
            this.updateRoleInput(type);
        },
        
        updateRoleTags: function(type) {
            const tagsContainer = document.getElementById(`${type}RoleTags`);
            const selectedSet = type === 'required' ? this.selectedRequiredRoles : this.selectedExemptRoles;
            
            if (!tagsContainer) return;
            
            if (selectedSet.size === 0) {
                tagsContainer.innerHTML = '<span style="color: rgba(255,255,255,0.5);">Click to select roles...</span>';
                return;
            }
            
            tagsContainer.innerHTML = '';
            selectedSet.forEach(roleId => {
                const role = this.rolesData.find(r => r.id === roleId);
                if (role) {
                    const tag = document.createElement('div');
                    tag.className = 'role-tag';
                    tag.innerHTML = `
                        ${role.name}
                        <span class="role-tag-remove" onclick="event.stopPropagation(); window.commandsApp.removeRole('${roleId}', '${type}')">√ó</span>
                    `;
                    tagsContainer.appendChild(tag);
                }
            });
        },
        
        removeRole: function(roleId, type) {
            const selectedSet = type === 'required' ? this.selectedRequiredRoles : this.selectedExemptRoles;
            selectedSet.delete(roleId);
            this.updateRoleTags(type);
            this.updateRoleInput(type);
        },
        
        updateRoleInput: function(type) {
            const selectedSet = type === 'required' ? this.selectedRequiredRoles : this.selectedExemptRoles;
            const input = document.getElementById(`${type}RolesInput`);
            if (input) {
                input.value = Array.from(selectedSet).join(',');
            }
        },
        
        loadRoleNames: function() {
            document.querySelectorAll('.role-badge[data-role-id]').forEach(badge => {
                const roleId = badge.dataset.roleId;
                const role = this.rolesData.find(r => r.id === roleId);
                if (role) {
                    const icon = badge.classList.contains('exempt') ? '‚úÖ' : 'üîí';
                    badge.textContent = `${icon} ${role.name}`;
                }
            });
        },
        
        // Tab switching
        switchMainTab: function(tabName, event) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const targetTab = document.getElementById(`tab-${tabName}`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Load data when switching to specific tabs
            if (tabName === 'sticky') {
                this.loadStickyMessages();
            } else if (tabName === 'rulesets') {
                this.loadRulesets();
            }
        },
        
        // Command filtering
        filterCommands: function(category, event) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            const cards = document.querySelectorAll('.command-card');
            cards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        },
        
        // Toggle create form
        toggleCreateForm: function() {
            const section = document.getElementById('createCommandSection');
            if (section) {
                section.style.display = section.style.display === 'none' ? 'block' : 'none';
            }
        },
        
        // Toggle command enabled/disabled
        toggleCommand: async function(commandId, type) {
            try {
                const response = await fetch(`/commands/toggle/${commandId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type })
                });
                
                if (response.ok) {
                    location.reload();
                } else {
                    alert('Failed to toggle command');
                }
            } catch (error) {
                console.error('Error toggling command:', error);
                alert('Error toggling command');
            }
        },
        
        // Edit command modal
        editCommand: function(commandId) {
            fetch(`/api/commands/${commandId}`)
                .then(res => res.json())
                .then(data => {
                    if (data.success && data.command) {
                        const cmd = data.command;
                        document.getElementById('editCommandId').value = cmd._id;
                        document.getElementById('editName').value = cmd.name;
                        document.getElementById('editCategory').value = cmd.category || 'general';
                        document.getElementById('editTrigger').value = Array.isArray(cmd.trigger) ? cmd.trigger.join(', ') : cmd.trigger;
                        document.getElementById('editResponse').value = cmd.response || '';
                        document.getElementById('editResponseType').value = cmd.responseType || 'text';
                        document.getElementById('editEnabled').checked = cmd.enabled;
                        
                        document.getElementById('editModal').style.display = 'block';
                    } else {
                        alert('Failed to load command data');
                    }
                })
                .catch(error => {
                    console.error('Error loading command:', error);
                    alert('Failed to load command data');
                });
        },
        
        closeEditModal: function() {
            const modal = document.getElementById('editModal');
            if (modal) {
                modal.style.display = 'none';
            }
        },
        
        // Bulk actions
        bulkToggleCommands: async function(enable) {
            if (!confirm(`Are you sure you want to ${enable ? 'enable' : 'disable'} all commands?`)) return;
            
            try {
                const response = await fetch('/commands/bulk/toggle', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ enable })
                });
                
                if (response.ok) {
                    location.reload();
                } else {
                    alert('Failed to update commands');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error updating commands');
            }
        },
        
        bulkCategoryAction: function() {
            const category = document.getElementById('bulkCategory').value;
            if (!category) {
                alert('Please select a category');
                return;
            }
            alert(`Bulk action for ${category} category - feature coming soon!`);
        },
        
        bulkDelete: async function() {
            try {
                const response = await fetch('/commands/bulk/delete-disabled', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    location.reload();
                } else {
                    alert('Failed to delete commands');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting commands');
            }
        },
        
        // Sticky Messages
        openStickyModal: async function() {
            document.getElementById('stickyModal').style.display = 'block';
            await this.loadChannelsForSticky();
        },
        
        closeStickyModal: function() {
            document.getElementById('stickyModal').style.display = 'none';
        },
        
        loadChannelsForSticky: async function() {
            try {
                const response = await fetch('/api/channels');
                const data = await response.json();
                
                if (data.success && data.channels) {
                    const select = document.getElementById('stickyChannelId');
                    if (select) {
                        select.innerHTML = '<option value="">Select Channel...</option>';
                        
                        data.channels.forEach(channel => {
                            const option = document.createElement('option');
                            option.value = channel.id;
                            option.textContent = `#${channel.name}`;
                            select.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading channels:', error);
            }
        },
        
        submitStickyForm: async function() {
            const form = document.getElementById('stickyMessageForm');
            const formData = new FormData(form);
            
            const data = {
                channelId: formData.get('channelId'),
                message: formData.get('message'),
                threshold: parseInt(formData.get('threshold')) || 10,
                enabled: formData.get('enabled') === 'on'
            };
            
            if (!data.channelId) {
                alert('Please select a channel');
                return;
            }
            
            if (!data.message || data.message.trim() === '') {
                alert('Please enter a message');
                return;
            }
            
            try {
                const response = await fetch('/commands/sticky/create', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Sticky message created successfully!');
                    this.closeStickyModal();
                    this.loadStickyMessages();
                } else {
                    alert('‚ùå Error: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating sticky:', error);
                alert('Failed to save sticky message: ' + error.message);
            }
        },
        
        loadStickyMessages: async function() {
            try {
                const response = await fetch('/commands/sticky/list');
                const data = await response.json();
                
                const container = document.getElementById('stickyMessagesList');
                if (!container) return;
                
                if (data.success && data.stickyMessages && data.stickyMessages.length > 0) {
                    container.innerHTML = '';
                    
                    data.stickyMessages.forEach(sticky => {
                        const card = document.createElement('div');
                        card.className = 'sticky-card';
                        card.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                <div>
                                    <span class="sticky-indicator">${sticky.enabled ? 'üî• Active' : '‚è∏Ô∏è Disabled'}</span>
                                    <h3 style="color: #fff; margin: 0.5rem 0;">#${sticky.channelName || 'Unknown Channel'}</h3>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn-icon" onclick="window.commandsApp.editSticky('${sticky._id}')" title="Edit">‚úèÔ∏è</button>
                                    <button class="btn-icon toggle" onclick="window.commandsApp.toggleSticky('${sticky._id}')" title="Toggle">
                                        ${sticky.enabled ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                                    </button>
                                    <button class="btn-icon delete" onclick="window.commandsApp.deleteSticky('${sticky._id}')" title="Delete">üóëÔ∏è</button>
                                </div>
                            </div>
                            <p style="color: rgba(255,255,255,0.7); margin-bottom: 1rem;">${sticky.message.length > 100 ? sticky.message.substring(0, 100) + '...' : sticky.message}</p>
                            <div style="display: flex; gap: 1rem; font-size: 0.85rem; color: rgba(255,255,255,0.5);">
                                <span>üìç Channel: #${sticky.channelName || sticky.channelId}</span>
                                <span>üí¨ Threshold: ${sticky.threshold} messages</span>
                                <span>üîÑ Reposts: ${sticky.repostCount || 0}</span>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìå</div>
                            <div class="empty-state-text">No sticky messages yet</div>
                            <div class="empty-state-subtext">Create sticky messages to keep important info visible</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading sticky messages:', error);
                const container = document.getElementById('stickyMessagesList');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #ed4245;">
                            <strong>Error loading sticky messages</strong><br>
                            <small>${error.message}</small>
                        </div>
                    `;
                }
            }
        },
        
        toggleSticky: async function(stickyId) {
            try {
                const response = await fetch(`/commands/sticky/toggle/${stickyId}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                if (result.success) {
                    this.loadStickyMessages();
                } else {
                    alert('Failed to toggle sticky message');
                }
            } catch (error) {
                console.error('Error toggling sticky:', error);
                alert('Error toggling sticky message');
            }
        },
        
        deleteSticky: async function(stickyId) {
            if (!confirm('Are you sure you want to delete this sticky message?')) return;
            
            try {
                const response = await fetch(`/commands/sticky/${stickyId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                if (result.success) {
                    this.loadStickyMessages();
                } else {
                    alert('Failed to delete sticky message');
                }
            } catch (error) {
                console.error('Error deleting sticky:', error);
                alert('Error deleting sticky message');
            }
        },
        
        editSticky: async function(stickyId) {
            try {
                const response = await fetch(`/commands/sticky/get/${stickyId}`);
                const data = await response.json();
                
                if (data.success && data.sticky) {
                    const sticky = data.sticky;
                    
                    document.getElementById('editStickyId').value = sticky._id;
                    document.getElementById('editStickyMessage').value = sticky.message;
                    document.getElementById('editStickyThreshold').value = sticky.threshold;
                    document.getElementById('editStickyEnabled').checked = sticky.enabled;
                    
                    // Load channels
                    const channelsResponse = await fetch('/api/channels');
                    const channelsData = await channelsResponse.json();
                    
                    if (channelsData.success && channelsData.channels) {
                        const select = document.getElementById('editStickyChannelId');
                        select.innerHTML = '<option value="">Select Channel...</option>';
                        
                        channelsData.channels.forEach(channel => {
                            const option = document.createElement('option');
                            option.value = channel.id;
                            option.textContent = `#${channel.name}`;
                            if (channel.id === sticky.channelId) {
                                option.selected = true;
                            }
                            select.appendChild(option);
                        });
                    }
                    
                    document.getElementById('editStickyModal').style.display = 'block';
                } else {
                    alert('Failed to load sticky message');
                }
            } catch (error) {
                console.error('Error loading sticky for edit:', error);
                alert('Failed to load sticky message');
            }
        },
        
        closeEditStickyModal: function() {
            document.getElementById('editStickyModal').style.display = 'none';
        },
        
        submitEditStickyForm: async function() {
            const form = document.getElementById('editStickyMessageForm');
            const formData = new FormData(form);
            
            const data = {
                channelId: formData.get('channelId'),
                message: formData.get('message'),
                threshold: parseInt(formData.get('threshold')) || 10,
                enabled: formData.get('enabled') === 'on'
            };
            
            if (!data.channelId || !data.message) {
                alert('Please fill in all required fields');
                return;
            }
            
            try {
                const stickyId = document.getElementById('editStickyId').value;
                const response = await fetch(`/commands/sticky/edit/${stickyId}`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Sticky message updated!');
                    this.closeEditStickyModal();
                    this.loadStickyMessages();
                } else {
                    alert('‚ùå Error: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error updating sticky:', error);
                alert('Failed to update sticky message');
            }
        },
        
        // Rulesets
        openRulesetModal: function() {
            document.getElementById('rulesetModal').style.display = 'block';
            this.updateRulesetTriggerFields();
            this.updateRulesetActionFields();
        },
        
        closeRulesetModal: function() {
            document.getElementById('rulesetModal').style.display = 'none';
        },
        
        updateRulesetTriggerFields: function() {
            const triggerType = document.getElementById('rulesetTriggerType')?.value;
            const container = document.getElementById('triggerConfigFields');
            
            if (!container) return;
            
            let html = '';
            
            switch(triggerType) {
                case 'spam':
                    html = `
                        <div class="form-group">
                            <label>Message Count</label>
                            <input type="number" name="messageCount" value="5" min="2" max="20">
                            <small>Number of messages</small>
                        </div>
                        <div class="form-group">
                            <label>Time Window (seconds)</label>
                            <input type="number" name="timeWindow" value="3" min="1" max="60">
                            <small>Within this time period</small>
                        </div>
                    `;
                    break;
                    
                case 'links':
                    html = `
                        <div class="form-group">
                            <label><input type="checkbox" name="blockDiscordInvites" checked> Block Discord Invites</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" name="blockAllUrls"> Block All URLs</label>
                        </div>
                        <div class="form-group">
                            <label>Whitelisted Domains (comma-separated)</label>
                            <input type="text" name="whitelistedDomains" placeholder="youtube.com, twitter.com">
                            <small>These domains will be allowed</small>
                        </div>
                    `;
                    break;
                    
                case 'words':
                    html = `
                        <div class="form-group">
                            <label>Banned Words (one per line)</label>
                            <textarea name="bannedWords" rows="5" placeholder="word1&#10;word2&#10;word3"></textarea>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" name="caseSensitive"> Case Sensitive</label>
                        </div>
                    `;
                    break;
                    
                case 'mentions':
                    html = `
                        <div class="form-group">
                            <label>Max Mentions</label>
                            <input type="number" name="maxMentions" value="5" min="1" max="20">
                            <small>Maximum user/role mentions per message</small>
                        </div>
                    `;
                    break;
                    
                case 'caps':
                    html = `
                        <div class="form-group">
                            <label>Caps Percentage</label>
                            <input type="number" name="capsPercentage" value="70" min="50" max="100">
                            <small>% of message in CAPS</small>
                        </div>
                        <div class="form-group">
                            <label>Minimum Length</label>
                            <input type="number" name="minLength" value="10" min="5" max="50">
                            <small>Minimum message length to check</small>
                        </div>
                    `;
                    break;
                    
                case 'attachments':
                    html = `
                        <div class="form-group">
                            <label>Max Attachments</label>
                            <input type="number" name="maxAttachments" value="3" min="1" max="10">
                            <small>Maximum attachments per message</small>
                        </div>
                    `;
                    break;
                    
                default:
                    html = '<p style="color: rgba(255,255,255,0.6);">Select a trigger type</p>';
            }
            
            container.innerHTML = html;
        },
        
        updateRulesetActionFields: function() {
            const actionType = document.getElementById('rulesetActionType')?.value;
            const container = document.getElementById('actionConfigFields');
            
            if (!container) return;
            
            let html = '';
            
            switch(actionType) {
                case 'delete':
                    html = `
                        <div class="form-group">
                            <label><input type="checkbox" name="notifyUser" checked> Notify User</label>
                        </div>
                    `;
                    break;
                    
                case 'warn':
                    html = `
                        <div class="form-group">
                            <label>Warning Message</label>
                            <textarea name="warnMessage" rows="3" placeholder="You have been warned for..."></textarea>
                        </div>
                    `;
                    break;
                    
                case 'timeout':
                    html = `
                        <div class="form-group">
                            <label>Timeout Duration</label>
                            <select name="timeoutDuration">
                                <option value="60">1 minute</option>
                                <option value="300" selected>5 minutes</option>
                                <option value="600">10 minutes</option>
                                <option value="1800">30 minutes</option>
                                <option value="3600">1 hour</option>
                            </select>
                        </div>
                    `;
                    break;
                    
                case 'kick':
                    html = `
                        <div class="form-group">
                            <label>Kick Reason</label>
                            <textarea name="kickReason" rows="2" placeholder="Kicked for violating rules"></textarea>
                        </div>
                    `;
                    break;
                    
                case 'ban':
                    html = `
                        <div class="form-group">
                            <label>Ban Reason</label>
                            <textarea name="banReason" rows="2" placeholder="Banned for violating rules"></textarea>
                        </div>
                    `;
                    break;
                    
                default:
                    html = '<p style="color: rgba(255,255,255,0.6);">Select an action type</p>';
            }
            
            container.innerHTML = html;
        },
        
        saveRuleset: async function(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            const triggerType = formData.get('triggerType');
            const triggerConfig = {};
            
            switch(triggerType) {
                case 'spam':
                    triggerConfig.messageCount = parseInt(formData.get('messageCount'));
                    triggerConfig.timeWindow = parseInt(formData.get('timeWindow'));
                    break;
                case 'links':
                    triggerConfig.blockDiscordInvites = formData.get('blockDiscordInvites') === 'on';
                    triggerConfig.blockAllUrls = formData.get('blockAllUrls') === 'on';
                    break;
                case 'words':
                    triggerConfig.bannedWords = formData.get('bannedWords')?.split('\n').filter(w => w.trim());
                    triggerConfig.caseSensitive = formData.get('caseSensitive') === 'on';
                    break;
                case 'mentions':
                    triggerConfig.maxMentions = parseInt(formData.get('maxMentions'));
                    break;
                case 'caps':
                    triggerConfig.capsPercentage = parseInt(formData.get('capsPercentage'));
                    triggerConfig.minLength = parseInt(formData.get('minLength'));
                    break;
                case 'attachments':
                    triggerConfig.maxAttachments = parseInt(formData.get('maxAttachments'));
                    break;
            }
            
            const actionType = formData.get('actionType');
            const actionConfig = {};
            
            switch(actionType) {
                case 'delete':
                    actionConfig.notifyUser = formData.get('notifyUser') === 'on';
                    break;
                case 'warn':
                    actionConfig.warnMessage = formData.get('warnMessage');
                    break;
                case 'timeout':
                    actionConfig.duration = parseInt(formData.get('timeoutDuration'));
                    break;
                case 'kick':
                    actionConfig.reason = formData.get('kickReason');
                    break;
                case 'ban':
                    actionConfig.reason = formData.get('banReason');
                    break;
            }
            
            const data = {
                name: formData.get('name'),
                description: formData.get('description'),
                triggerType: triggerType,
                triggerConfig: triggerConfig,
                actionType: actionType,
                actionConfig: actionConfig,
                priority: formData.get('priority'),
                excludedRoles: formData.get('excludedRoles')?.split(',').filter(r => r.trim()) || [],
                excludedChannels: formData.get('excludedChannels')?.split(',').filter(c => c.trim()) || [],
                whitelistedDomains: formData.get('whitelistedDomains')?.split(',').map(d => d.trim()) || []
            };
            
            try {
                const response = await fetch('/commands/ruleset/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Ruleset created successfully!');
                    this.closeRulesetModal();
                    this.loadRulesets();
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                console.error('Error saving ruleset:', error);
                alert('Failed to save ruleset');
            }
        },
        
        loadRulesets: async function() {
            try {const response = await fetch('/commands/ruleset/list');
                const data = await response.json();
                
                const container = document.getElementById('rulesetsListContainer');
                if (!container) return;
                
                if (data.success && data.rulesets && data.rulesets.length > 0) {
                    container.innerHTML = '';
                    
                    data.rulesets.forEach(ruleset => {
                        const card = document.createElement('div');
                        card.className = 'ruleset-card';
                        
                        const priorityColors = {
                            high: { bg: 'rgba(237,66,69,0.2)', color: '#ed4245', icon: 'üî¥' },
                            medium: { bg: 'rgba(250,166,26,0.2)', color: '#faa61a', icon: 'üü°' },
                            low: { bg: 'rgba(67,181,129,0.2)', color: '#43b581', icon: 'üü¢' }
                        };
                        
                        const priority = priorityColors[ruleset.priority] || priorityColors.medium;
                        
                        card.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                        <h3 style="color: #fff; margin: 0;">${ruleset.name}</h3>
                                        <span class="badge ${ruleset.enabled ? 'badge-enabled' : 'badge-disabled'}">
                                            ${ruleset.enabled ? 'Enabled' : 'Disabled'}
                                        </span>
                                        <span class="badge" style="background: ${priority.bg}; color: ${priority.color};">
                                            ${priority.icon} ${ruleset.priority.charAt(0).toUpperCase() + ruleset.priority.slice(1)} Priority
                                        </span>
                                    </div>
                                    <p style="color: rgba(255,255,255,0.6); margin: 0; font-size: 0.9rem;">
                                        ${ruleset.description || 'No description'}
                                    </p>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn-icon" onclick="window.commandsApp.editRuleset('${ruleset._id}')" title="Edit">‚úèÔ∏è</button>
                                    <button class="btn-icon toggle" onclick="window.commandsApp.toggleRuleset('${ruleset._id}')" title="Toggle">
                                        ${ruleset.enabled ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                                    </button>
                                    <button class="btn-icon delete" onclick="window.commandsApp.deleteRuleset('${ruleset._id}')" title="Delete">üóëÔ∏è</button>
                                </div>
                            </div>
                            
                            <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 0.75rem;">
                                    <div>
                                        <strong style="color: rgba(255,255,255,0.7); font-size: 0.75rem; display: block; margin-bottom: 0.25rem;">TRIGGER</strong>
                                        <span style="color: #fff; font-size: 0.9rem;">${this.getTriggerDescription(ruleset.trigger)}</span>
                                    </div>
                                    <div>
                                        <strong style="color: rgba(255,255,255,0.7); font-size: 0.75rem; display: block; margin-bottom: 0.25rem;">ACTION</strong>
                                        <span style="color: #ed4245; font-size: 0.9rem;">${this.getActionDescription(ruleset.action)}</span>
                                    </div>
                                </div>
                                
                                ${ruleset.exclusions && (ruleset.exclusions.roles?.length > 0 || ruleset.exclusions.channels?.length > 0) ? `
                                    <div>
                                        <strong style="color: rgba(255,255,255,0.7); font-size: 0.75rem; display: block; margin-bottom: 0.25rem;">EXCLUSIONS</strong>
                                        <div style="display: flex; flex-wrap: wrap; gap: 0.25rem; margin-top: 0.5rem;">
                                            ${ruleset.exclusions.roles?.map(roleId => 
                                                `<span class="role-badge exempt">Role: ${roleId.substring(0, 8)}...</span>`
                                            ).join('') || ''}
                                            ${ruleset.exclusions.channels?.map(channelId => 
                                                `<span class="badge" style="background: rgba(67,181,129,0.2); color: #43b581;">#${channelId.substring(0, 8)}...</span>`
                                            ).join('') || ''}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div style="display: flex; gap: 1rem; font-size: 0.85rem; color: rgba(255,255,255,0.5);">
                                <span>üéØ Triggered: ${ruleset.stats?.triggered || 0} times</span>
                                <span>‚è∞ ${ruleset.stats?.lastTriggered ? 
                                    'Last: ' + new Date(ruleset.stats.lastTriggered).toLocaleString() : 
                                    'Never triggered'}</span>
                            </div>
                        `;
                        
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üõ°Ô∏è</div>
                            <div style="color: rgba(255,255,255,0.8); font-weight: 600; margin-bottom: 0.5rem;">No AutoMod Rulesets Yet</div>
                            <div style="color: rgba(255,255,255,0.5); font-size: 0.9rem; margin-bottom: 1.5rem;">Create rulesets to automatically moderate your server</div>
                            <button onclick="window.commandsApp.openRulesetModal()" class="btn btn-primary">Create Your First Ruleset</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading rulesets:', error);
                const container = document.getElementById('rulesetsListContainer');
                if (container) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #ed4245;">
                            <strong>Error loading rulesets</strong><br>
                            <small>${error.message}</small>
                        </div>
                    `;
                }
            }
        },
        
        getTriggerDescription: function(trigger) {
            if (!trigger) return 'Unknown trigger';
            
            const descriptions = {
                spam: `${trigger.config?.messageCount || 5} messages in ${trigger.config?.timeWindow || 3}s`,
                links: 'Contains links or invites',
                words: `Contains ${trigger.config?.bannedWords?.length || 0} banned words`,
                mentions: `${trigger.config?.maxMentions || 5}+ mentions`,
                caps: `${trigger.config?.capsPercentage || 70}% caps`,
                attachments: `${trigger.config?.maxAttachments || 3}+ attachments`
            };
            
            return descriptions[trigger.type] || trigger.type;
        },
        
        getActionDescription: function(action) {
            if (!action) return 'Unknown action';
            
            const descriptions = {
                delete: 'Delete message',
                warn: 'Warn user',
                timeout: `Timeout ${action.config?.duration ? Math.floor(action.config.duration / 60) + 'm' : '5m'}`,
                kick: 'Kick user',
                ban: 'Ban user'
            };
            
            return descriptions[action.type] || action.type;
        },
        
        editRuleset: async function(rulesetId) {
    try {
        const response = await fetch(`/api/automod/rulesets/${rulesetId}`);
        const data = await response.json();
        
        if (!data.success || !data.ruleset) {
            alert('Failed to load ruleset');
            return;
        }
        
        const ruleset = data.ruleset;
        
        // Populate form fields
        document.getElementById('editRulesetId').value = ruleset._id;
        document.getElementById('editRulesetName').value = ruleset.name;
        document.getElementById('editRulesetDescription').value = ruleset.description || '';
        document.getElementById('editRulesetPriority').value = ruleset.priority || 'medium';
        
        // Set trigger type
        document.getElementById('editRulesetTriggerType').value = ruleset.trigger.type;
        
        // Set action type
        document.getElementById('editRulesetActionType').value = ruleset.action.type;
        
        // Set exclusions
        if (ruleset.exclusions) {
            document.getElementById('editExcludedRoles').value = (ruleset.exclusions.roles || []).join(', ');
            document.getElementById('editExcludedChannels').value = (ruleset.exclusions.channels || []).join(', ');
        }
        
        // Set whitelist
        if (ruleset.whitelist) {
            document.getElementById('editWhitelistedDomains').value = ruleset.whitelist.join(', ');
        }
        
        // Update the config fields
        this.updateEditRulesetTriggerFields();
        this.updateEditRulesetActionFields();
        
        // Populate trigger config
        setTimeout(() => {
            this.populateEditTriggerConfig(ruleset.trigger);
            this.populateEditActionConfig(ruleset.action);
        }, 100);
        
        // Show modal
        document.getElementById('editRulesetModal').style.display = 'block';
        
    } catch (error) {
        console.error('Error loading ruleset:', error);
        alert('Failed to load ruleset: ' + error.message);
    }
},

closeEditRulesetModal: function() {
    document.getElementById('editRulesetModal').style.display = 'none';
},

updateEditRulesetTriggerFields: function() {
    const triggerType = document.getElementById('editRulesetTriggerType')?.value;
    const container = document.getElementById('editTriggerConfigFields');
    
    if (!container) return;
    
    let html = '';
    
    switch(triggerType) {
        case 'spam':
            html = `
                <div class="form-group">
                    <label>Message Count</label>
                    <input type="number" name="messageCount" id="editMessageCount" value="5" min="2" max="20">
                </div>
                <div class="form-group">
                    <label>Time Window (seconds)</label>
                    <input type="number" name="timeWindow" id="editTimeWindow" value="3" min="1" max="60">
                </div>
            `;
            break;
            
        case 'links':
            html = `
                <div class="form-group">
                    <label><input type="checkbox" name="blockDiscordInvites" id="editBlockDiscordInvites"> Block Discord Invites</label>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="blockAllUrls" id="editBlockAllUrls"> Block All URLs</label>
                </div>
            `;
            break;
            
        case 'words':
            html = `
                <div class="form-group">
                    <label>Banned Words (one per line)</label>
                    <textarea name="bannedWords" id="editBannedWords" rows="5" placeholder="word1&#10;word2&#10;word3"></textarea>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" name="caseSensitive" id="editCaseSensitive"> Case Sensitive</label>
                </div>
            `;
            break;
            
        case 'mentions':
            html = `
                <div class="form-group">
                    <label>Max Mentions</label>
                    <input type="number" name="maxMentions" id="editMaxMentions" value="5" min="1" max="20">
                </div>
            `;
            break;
            
        case 'caps':
            html = `
                <div class="form-group">
                    <label>Caps Percentage</label>
                    <input type="number" name="capsPercentage" id="editCapsPercentage" value="70" min="50" max="100">
                </div>
                <div class="form-group">
                    <label>Minimum Length</label>
                    <input type="number" name="minLength" id="editMinLength" value="10" min="5" max="50">
                </div>
            `;
            break;
            
        case 'attachments':
            html = `
                <div class="form-group">
                    <label>Max Attachments</label>
                    <input type="number" name="maxAttachments" id="editMaxAttachments" value="3" min="1" max="10">
                </div>
            `;
            break;
            
        default:
            html = '<p style="color: rgba(255,255,255,0.6);">Select a trigger type</p>';
    }
    
    container.innerHTML = html;
},

updateEditRulesetActionFields: function() {
    const actionType = document.getElementById('editRulesetActionType')?.value;
    const container = document.getElementById('editActionConfigFields');
    
    if (!container) return;
    
    let html = '';
    
    switch(actionType) {
        case 'delete':
            html = `
                <div class="form-group">
                    <label><input type="checkbox" name="notifyUser" id="editNotifyUser"> Notify User</label>
                </div>
            `;
            break;
            
        case 'warn':
            html = `
                <div class="form-group">
                    <label>Warning Message</label>
                    <textarea name="warnMessage" id="editWarnMessage" rows="3" placeholder="You have been warned for..."></textarea>
                </div>
            `;
            break;
            
        case 'timeout':
            html = `
                <div class="form-group">
                    <label>Timeout Duration</label>
                    <select name="timeoutDuration" id="editTimeoutDuration">
                        <option value="60">1 minute</option>
                        <option value="300">5 minutes</option>
                        <option value="600">10 minutes</option>
                        <option value="1800">30 minutes</option>
                        <option value="3600">1 hour</option>
                    </select>
                </div>
            `;
            break;
            
        case 'kick':
            html = `
                <div class="form-group">
                    <label>Kick Reason</label>
                    <textarea name="kickReason" id="editKickReason" rows="2" placeholder="Kicked for violating rules"></textarea>
                </div>
            `;
            break;
            
        case 'ban':
            html = `
                <div class="form-group">
                    <label>Ban Reason</label>
                    <textarea name="banReason" id="editBanReason" rows="2" placeholder="Banned for violating rules"></textarea>
                </div>
            `;
            break;
            
        default:
            html = '<p style="color: rgba(255,255,255,0.6);">Select an action type</p>';
    }
    
    container.innerHTML = html;
},

populateEditTriggerConfig: function(trigger) {
    if (!trigger || !trigger.config) return;
    
    const config = trigger.config;
    
    switch(trigger.type) {
        case 'spam':
            if (config.messageCount) document.getElementById('editMessageCount').value = config.messageCount;
            if (config.timeWindow) document.getElementById('editTimeWindow').value = config.timeWindow;
            break;
        case 'links':
            if (config.blockDiscordInvites) document.getElementById('editBlockDiscordInvites').checked = true;
            if (config.blockAllUrls) document.getElementById('editBlockAllUrls').checked = true;
            break;
        case 'words':
            if (config.bannedWords) document.getElementById('editBannedWords').value = config.bannedWords.join('\n');
            if (config.caseSensitive) document.getElementById('editCaseSensitive').checked = true;
            break;
        case 'mentions':
            if (config.maxMentions) document.getElementById('editMaxMentions').value = config.maxMentions;
            break;
        case 'caps':
            if (config.capsPercentage) document.getElementById('editCapsPercentage').value = config.capsPercentage;
            if (config.minLength) document.getElementById('editMinLength').value = config.minLength;
            break;
        case 'attachments':
            if (config.maxAttachments) document.getElementById('editMaxAttachments').value = config.maxAttachments;
            break;
    }
},

populateEditActionConfig: function(action) {
    if (!action || !action.config) return;
    
    const config = action.config;
    
    switch(action.type) {
        case 'delete':
            if (config.notifyUser) document.getElementById('editNotifyUser').checked = true;
            break;
        case 'warn':
            if (config.warnMessage) document.getElementById('editWarnMessage').value = config.warnMessage;
            break;
        case 'timeout':
            if (config.duration) document.getElementById('editTimeoutDuration').value = config.duration;
            break;
        case 'kick':
            if (config.reason) document.getElementById('editKickReason').value = config.reason;
            break;
        case 'ban':
            if (config.reason) document.getElementById('editBanReason').value = config.reason;
            break;
    }
},

updateRuleset: async function(event) {
    event.preventDefault();
    
    const form = event.target;
    const formData = new FormData(form);
    const rulesetId = document.getElementById('editRulesetId').value;
    
    const triggerType = formData.get('triggerType');
    const triggerConfig = {};
    
    switch(triggerType) {
        case 'spam':
            triggerConfig.messageCount = parseInt(formData.get('messageCount'));
            triggerConfig.timeWindow = parseInt(formData.get('timeWindow'));
            break;
        case 'links':
            triggerConfig.blockDiscordInvites = formData.get('blockDiscordInvites') === 'on';
            triggerConfig.blockAllUrls = formData.get('blockAllUrls') === 'on';
            break;
        case 'words':
            triggerConfig.bannedWords = formData.get('bannedWords')?.split('\n').filter(w => w.trim());
            triggerConfig.caseSensitive = formData.get('caseSensitive') === 'on';
            break;
        case 'mentions':
            triggerConfig.maxMentions = parseInt(formData.get('maxMentions'));
            break;
        case 'caps':
            triggerConfig.capsPercentage = parseInt(formData.get('capsPercentage'));
            triggerConfig.minLength = parseInt(formData.get('minLength'));
            break;
        case 'attachments':
            triggerConfig.maxAttachments = parseInt(formData.get('maxAttachments'));
            break;
    }
    
    const actionType = formData.get('actionType');
    const actionConfig = {};
    
    switch(actionType) {
        case 'delete':
            actionConfig.notifyUser = formData.get('notifyUser') === 'on';
            break;
        case 'warn':
            actionConfig.warnMessage = formData.get('warnMessage');
            break;
        case 'timeout':
            actionConfig.duration = parseInt(formData.get('timeoutDuration'));
            break;
        case 'kick':
            actionConfig.reason = formData.get('kickReason');
            break;
        case 'ban':
            actionConfig.reason = formData.get('banReason');
            break;
    }
    
    const data = {
        name: formData.get('name'),
        description: formData.get('description'),
        triggerType: triggerType,
        triggerConfig: triggerConfig,
        actionType: actionType,
        actionConfig: actionConfig,
        priority: formData.get('priority'),
        excludedRoles: formData.get('excludedRoles')?.split(',').filter(r => r.trim()) || [],
        excludedChannels: formData.get('excludedChannels')?.split(',').filter(c => c.trim()) || [],
        whitelistedDomains: formData.get('whitelistedDomains')?.split(',').map(d => d.trim()) || []
    };
    
    try {
        const response = await fetch(`/commands/ruleset/edit/${rulesetId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ Ruleset updated successfully!');
            this.closeEditRulesetModal();
            this.loadRulesets();
        } else {
            alert('Error: ' + (result.error || 'Failed to update ruleset'));
        }
    } catch (error) {
        console.error('Error updating ruleset:', error);
        alert('Failed to update ruleset: ' + error.message);
    }
},
        
        toggleRuleset: async function(rulesetId) {
            try {
                const response = await fetch(`/commands/ruleset/toggle/${rulesetId}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    this.loadRulesets();
                } else {
                    alert('Failed to toggle ruleset');
                }
            } catch (error) {
                console.error('Error toggling ruleset:', error);
                alert('Error toggling ruleset');
            }
        },
        
        deleteRuleset: async function(rulesetId) {
            if (!confirm('Are you sure you want to delete this ruleset?')) return;
            
            try {
                const response = await fetch(`/commands/ruleset/${rulesetId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Ruleset deleted!');
                    this.loadRulesets();
                } else {
                    alert('Failed to delete ruleset');
                }
            } catch (error) {
                console.error('Error deleting ruleset:', error);
                alert('Error deleting ruleset');
            }
        }
    };
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            window.commandsApp.init();
            console.log('‚úÖ Commands app initialized on DOMContentLoaded');
        });
    } else {
        window.commandsApp.init();
        console.log('‚úÖ Commands app initialized immediately');
    }
</script>
</body>
</html>